<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"drinkwateronly.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Wallnut">
<meta property="og:url" content="https://drinkwateronly.github.io/page/2/index.html">
<meta property="og:site_name" content="Wallnut">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Wallnut">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://drinkwateronly.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Wallnut</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Wallnut</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wallnut"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Wallnut</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/drinkwateronly" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;drinkwateronly" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/2978ee3a4e31/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/2978ee3a4e31/" class="post-title-link" itemprop="url">Docker基础教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-27 10:42:07" itemprop="dateCreated datePublished" datetime="2023-11-27T10:42:07+08:00">2023-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-21 19:24:21" itemprop="dateModified" datetime="2024-03-21T19:24:21+08:00">2024-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%90%8E%E7%AB%AF/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1HP4118797/?spm_id_from=333.337.search-card.all.click&vd_source=9883419bb9939eb61834a63a38921b19">https://www.bilibili.com/video/BV1HP4118797/?spm_id_from=333.337.search-card.all.click&amp;vd_source=9883419bb9939eb61834a63a38921b19</a></p>
<h1 id="Docker基础教程"><a href="#Docker基础教程" class="headerlink" title="Docker基础教程"></a>Docker基础教程</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>使用Docker安装应用时会从镜像仓库自动下载镜像image，镜像包含应用本身，还包含应用运行所需的环境、配置、系统函数库。镜像仓库由docker官方管理。</p>
<p>也就是镜像可以忽略操作系统的差异直接部署。</p>
<p>Docker运行image会创建一个隔离环境，即容器container。多个容器是互不干扰的。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123103249728.png" alt="image-20231123103249728"></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>linux版本centOS 7，对应官方文档</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
</blockquote>
<p>安装教程</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://b11et3un53m.feishu.cn/wiki/Rfocw7ctXij2RBkShcucLZbrn2d">https://b11et3un53m.feishu.cn/wiki/Rfocw7ctXij2RBkShcucLZbrn2d</a></p>
</blockquote>
<p>1、安装yum（centOS已有），并配置仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>2、安装docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p>3、启动和关闭</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker ps <span class="comment"># 不报错则安装成功</span></span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl stop docker</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> docker <span class="comment"># 设置开启自启</span></span><br></pre></td></tr></table></figure>

<p>4、配置镜像加速</p>
<p>配置阿里云镜像加速</p>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<p>添加其他镜像加速</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<p>添加如下其中一项内容即可（实测，只能添加其中一个），如果某个速度慢，可以切换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://_______.mirror.aliyuncs.com&quot;</span>]  <span class="comment"># 空白处从阿里云获取</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://mirror.baidubce.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://registry.docker-cn.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者用如下命令快速完成配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://_______.mirror.aliyuncs.com&quot;</span>]  <span class="comment"># 空白处从阿里云获取</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://mirror.baidubce.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://registry.docker-cn.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>



<h2 id="demo-部署mysql"><a href="#demo-部署mysql" class="headerlink" title="demo: 部署mysql"></a>demo: 部署mysql</h2><h3 id="下载并安装image"><a href="#下载并安装image" class="headerlink" title="下载并安装image"></a>下载并安装image</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \ <span class="comment"># 创建并运行 -d使得容器在后台运行</span></span><br><span class="line">--name mysql \  <span class="comment"># 容器名称</span></span><br><span class="line">-p 3306:3306 \  <span class="comment"># 端口映射</span></span><br><span class="line">-e TZ=Asia/Shanghai \  <span class="comment"># 环境变量 -e KEY=VALUE，不同镜像不同，需要查看镜像的文档说明</span></span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \ </span><br><span class="line">mysql \  <span class="comment"># 镜像的名字 [仓库]:[版本号]，无版本号就是最新版本</span></span><br></pre></td></tr></table></figure>

<p>端口映射：</p>
<ul>
<li>端口映射：容器由于是独立的，拥有自己的文件系统、内存空间、网络空间，也有自己的IP，但是是对外隔离的，所以当主机ping容器的ip时，是无法访问的，因此可以端口映射，将虚拟机的3306端口映射到容器的3306端口。</li>
<li>mysql的端口永远是3306，但宿主机进行端口映射的端口可以不是3306，比如<code>-p 3310:3306</code>。</li>
</ul>
<h3 id="navicat连接数据库："><a href="#navicat连接数据库：" class="headerlink" title="navicat连接数据库："></a>navicat连接数据库：</h3><p>1、由于使用虚拟机，此处要使用SSH连接虚拟机，注意，此处的虚拟机和主机采用桥接模式，同属一个内网中。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123214213515.png" alt="image-20231123214213515"></p>
<p>2、进行数据库的连接</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123214624203.png" alt="image-20231123214624203"></p>
<blockquote>
<p>memo：数据库账号是root（默认），密码123456，CentOS账号wallnut，密码生日。</p>
</blockquote>
<p>3、连接成功</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123214946891.png" alt="image-20231123214946891"></p>
<h2 id="镜像、容器常见命令"><a href="#镜像、容器常见命令" class="headerlink" title="镜像、容器常见命令"></a>镜像、容器常见命令</h2><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123104353877.png" alt="image-20231123104353877"></p>
<p>（注：DockerFile用于定制镜像，左下是将镜像存储并加载）</p>
<p>区分镜像和容器，可以类比为程序和进程。</p>
<h3 id="查看已有镜像"><a href="#查看已有镜像" class="headerlink" title="查看已有镜像"></a>查看已有镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx        latest    a6bd71f48f68   2 days ago      187MB</span><br><span class="line">mysql        5.7       bdba757bc933   4 weeks ago     501MB</span><br><span class="line">mysql        latest    3218b38490ce   23 months ago   516MB</span><br></pre></td></tr></table></figure>



<h3 id="从远端仓库拉取镜像-pull"><a href="#从远端仓库拉取镜像-pull" class="headerlink" title="从远端仓库拉取镜像 pull"></a>从远端仓库拉取镜像 pull</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>



<h3 id="保存镜像到本地-save"><a href="#保存镜像到本地-save" class="headerlink" title="保存镜像到本地 save"></a>保存镜像到本地 save</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o nginx.tar nginx:latest <span class="comment"># 注意要把版本号TAG也放上，因为可能有不同的版本号但相同的Repository</span></span><br></pre></td></tr></table></figure>



<h3 id="删除本地镜像-rmi"><a href="#删除本地镜像-rmi" class="headerlink" title="删除本地镜像 rmi"></a>删除本地镜像 rmi</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi nginx:latest <span class="comment"># 注意要把版本号TAG也放上，因为可能有不同的版本号但相同的Repository</span></span><br></pre></td></tr></table></figure>



<h3 id="加载本地镜像-load"><a href="#加载本地镜像-load" class="headerlink" title="加载本地镜像 load"></a>加载本地镜像 load</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker load -i nginx.tar</span><br><span class="line"><span class="number">92770</span>f546e06: Loading layer [==================================================&gt;]  <span class="number">77.87</span>MB/<span class="number">77.87</span>MB</span><br><span class="line"><span class="number">8</span>ae474e0cc8f: Loading layer [==================================================&gt;]  <span class="number">113.1</span>MB/<span class="number">113.1</span>MB</span><br><span class="line">f5525891d9e9: Loading layer [==================================================&gt;]  <span class="number">3.584</span>kB/<span class="number">3.584</span>kB</span><br><span class="line"><span class="number">66283570</span>f41b: Loading layer [==================================================&gt;]  <span class="number">4.608</span>kB/<span class="number">4.608</span>kB</span><br><span class="line">c2d3ab485d1b: Loading layer [==================================================&gt;]   <span class="number">2.56</span>kB/<span class="number">2.56</span>kB</span><br><span class="line">cddc309885a2: Loading layer [==================================================&gt;]   <span class="number">5.12</span>kB/<span class="number">5.12</span>kB</span><br><span class="line"><span class="number">0</span>d0e9c83b6f7: Loading layer [==================================================&gt;]  <span class="number">7.168</span>kB/<span class="number">7.168</span>kB</span><br></pre></td></tr></table></figure>



<h3 id="运行本地镜像-run"><a href="#运行本地镜像-run" class="headerlink" title="运行本地镜像 run"></a>运行本地镜像 run</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx -p 80:80 nginx</span><br><span class="line">0cb11aaca245abc658a96c7ad05f731678f3570419d856773013e83e7f4225ad</span><br></pre></td></tr></table></figure>



<h3 id="查看已有容器-ps"><a href="#查看已有容器-ps" class="headerlink" title="查看已有容器 ps"></a>查看已有容器 ps</h3><p>可用参数<code>format</code>指定输出格式，参数<code>-a</code>使用时，显示所有容器；否则仅显示正在运行的容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line">docker ps</span><br><span class="line">docker ps --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE       PORTS                                                  STATUS        NAMES</span><br><span class="line">0cb11aaca245   nginx       0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp                      Up 2 hours    nginx</span><br><span class="line">563cc50d335e   mysql:5.7   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   Up 17 hours   mysql</span><br></pre></td></tr></table></figure>

<h4 id="命令别名"><a href="#命令别名" class="headerlink" title="命令别名"></a>命令别名</h4><p>由于format指定输出格式的指令非常长，如果经常使用，可以设置一个命令别名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bashrc</span><br><span class="line"><span class="comment"># 添加：</span></span><br><span class="line"><span class="comment"># alias dpsf=&#x27;docker ps --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;&#x27;</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">dpsf</span><br></pre></td></tr></table></figure>



<h3 id="关闭容器-stop"><a href="#关闭容器-stop" class="headerlink" title="关闭容器 stop"></a>关闭容器 stop</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop nginx</span><br></pre></td></tr></table></figure>



<h3 id="运行容器-start"><a href="#运行容器-start" class="headerlink" title="运行容器 start"></a>运行容器 start</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start nginx</span><br></pre></td></tr></table></figure>



<h3 id="日志-logs"><a href="#日志-logs" class="headerlink" title="日志 logs"></a>日志 logs</h3><p>参数<code>-f</code>使用时，持续跟踪日志，否则只打印历史日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f nginx </span><br></pre></td></tr></table></figure>



<h3 id="进入容器执行-exec"><a href="#进入容器执行-exec" class="headerlink" title="进入容器执行 exec"></a>进入容器执行 exec</h3><p> <code>-it</code>:可交互终端 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts] docker <span class="built_in">exec</span> -it nginx bash</span><br><span class="line">root@0cb11aaca245:/ <span class="built_in">ls</span></span><br><span class="line">bin   dev		   docker-entrypoint.sh  home  lib32  libx32  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  docker-entrypoint.d  etc			 lib   lib64  media   opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>

<p>退出容器执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>



<h3 id="删除容器-rm"><a href="#删除容器-rm" class="headerlink" title="删除容器 rm"></a>删除容器 rm</h3><p>被删除的容器要先停止运行stop，除非使用<code>-f</code>强制删除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> nginx</span><br></pre></td></tr></table></figure>



<h2 id="部署nginx遇到的问题"><a href="#部署nginx遇到的问题" class="headerlink" title="部署nginx遇到的问题"></a>部署nginx遇到的问题</h2><p>虚拟机可以通过curl访问已部署的nginx容器，但宿主机既不能通过curl访问，也不能通过浏览器访问该ip。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 172.31.226.34</span><br></pre></td></tr></table></figure>

<p>原因：虚拟机防火墙未关闭</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld <span class="comment"># 如果是active 就是未关闭</span></span><br><span class="line">systemctl stop firewalld.service <span class="comment"># 关闭即可解决</span></span><br><span class="line">systemctl restart docker <span class="comment"># 重启docker</span></span><br></pre></td></tr></table></figure>



<h2 id="数据卷挂载"><a href="#数据卷挂载" class="headerlink" title="数据卷挂载"></a>数据卷挂载</h2><p>为什么需要数据卷：若想修改容器内的文件，使用exec命令进入容器的bash后，发现无法使用vi修改其中的文件，原因是容器只提供了最小化的系统环境，而vi不是必要的。</p>
<p>数据卷volume：虚拟目录，容器内目录和宿主机目录之间映射的桥梁。</p>
<p>即便容器删了，数据仍会保存在虚拟机中。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231124153318786.png" alt="image-20231124153318786"></p>
<p>挂载数据卷要在容器运行时进行挂载，正在运行的容器不能再挂载数据卷。容器运行时，若不指定挂载名，会自动创建数据卷。</p>
<h3 id="数据卷命令"><a href="#数据卷命令" class="headerlink" title="数据卷命令"></a>数据卷命令</h3><p><img src="C:/Users/wallnut/AppData/Roaming/Typora/typora-user-images/image-20231124154230723.png" alt="image-20231124154230723"></p>
<h3 id="demo：利用nginx部署静态资源"><a href="#demo：利用nginx部署静态资源" class="headerlink" title="demo：利用nginx部署静态资源"></a>demo：利用nginx部署静态资源</h3><ul>
<li>创建nginx容器，并修改html目录下的index.html文件</li>
<li>将静态资源部署到html目录。</li>
</ul>
<h4 id="运行容器时挂载数据卷"><a href="#运行容器时挂载数据卷" class="headerlink" title="运行容器时挂载数据卷"></a>运行容器时挂载数据卷</h4><p>参数<code>-v 数据卷名：容器内目录</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx</span><br></pre></td></tr></table></figure>

<h4 id="查看挂载的数据卷"><a href="#查看挂载的数据卷" class="headerlink" title="查看挂载的数据卷"></a>查看挂载的数据卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker volume <span class="built_in">ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     d156f43095144e073085f20b9d0d2ca802e81358b99fe6273e3420ec6338ccdf</span><br><span class="line"><span class="built_in">local</span>     db24dc659d6f0dfd0aa3d931561e585b2cf393c636dda5b3967720131175e285</span><br><span class="line"><span class="built_in">local</span>     e90f11091bc53a779f4a6f5b6ec12d0ef0e2aa2fb40ffe6c6181e09ffc17ad2d</span><br><span class="line"><span class="built_in">local</span>     ffc104a40519463581ffa58433e95225ed93894cfdb44d3d1400b2a3e66ffabb</span><br><span class="line"><span class="built_in">local</span>     html</span><br></pre></td></tr></table></figure>

<h4 id="查看html数据卷详细信息"><a href="#查看html数据卷详细信息" class="headerlink" title="查看html数据卷详细信息"></a>查看html数据卷详细信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect html</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2023-11-23T23:46:58-08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/html/_data&quot;</span>,  <span class="comment"># 虚拟机目录</span></span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;html&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>至此，虚拟机目录<code>&quot;/var/lib/docker/volumes/html/_data&quot;</code>和html数据卷映射，html数据卷又和容器目录<code>/usr/share/nginx/html</code>映射</p>
<h4 id="修改html文件或添加静态资源"><a href="#修改html文件或添加静态资源" class="headerlink" title="修改html文件或添加静态资源"></a>修改html文件或添加静态资源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /var/lib/docker/volumes/html/_data/index.html</span><br></pre></td></tr></table></figure>



<h2 id="目录挂载"><a href="#目录挂载" class="headerlink" title="目录挂载"></a>目录挂载</h2><p>用于数据的迁移，例如原本的mysql进行版本升级，所以需要新版本mysql的容器，并把原始数据迁移到新的mysql。</p>
<h3 id="demo："><a href="#demo：" class="headerlink" title="demo："></a>demo：</h3><p>当前mysql的挂载信息，名字很长一串，这是在run是默认时，随机生成的数据卷，称为匿名卷。可以看到虚拟机目录<code>/var/lib/docker/volumes/d156f43095144e073085f20b9d0d2ca802e81358b99fe6273e3420ec6338ccdf/_data/mysql</code>存放了mysql的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker inspect mysql</span><br><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;d156f43095144e073085f20b9d0d2ca802e81358b99fe6273e3420ec6338ccdf&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/d156f43095144e073085f20b9d0d2ca802e81358b99fe6273e3420ec6338ccdf/_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/var/lib/mysql&quot;</span>,</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost wallnut]<span class="comment"># cd /var/lib/docker/volumes/d156f43095144e073085f20b9d0d2ca802e81358b99fe6273e3420ec6338ccdf/_data</span></span><br><span class="line">[root@localhost _data]<span class="comment"># ls</span></span><br><span class="line">auto.cnf         client-key.pem  ib_logfile1         private_key.pem  sys</span><br><span class="line">ca-key.pem       ib_buffer_pool  mysql               public_key.pem</span><br><span class="line">ca.pem           ibdata1         mysql.sock          server-cert.pem</span><br><span class="line">client-cert.pem  ib_logfile0     performance_schema  server-key.pem</span><br></pre></td></tr></table></figure>

<p><del>使用navicat为该数据库创建一个数据库pvz和一个wallnut表，用于后续数据迁移的验证。</del></p>
<p>目录挂载和数据卷挂载使用docker run命令时挂载，参数<code>-v 本地目录:容器内目录</code>。注意，本地目录要以<code>/</code>或<code>./</code>开头，即要以绝对路径和相对路径开头，否则会被识别为数据卷。</p>
<p>此外还需要挂载配置文件、初始化脚本，感觉较难用上此处不做深入（视频P8）。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231124203920577.png" alt="image-20231124203920577"></p>
<h2 id="自定义镜像"><a href="#自定义镜像" class="headerlink" title="自定义镜像"></a>自定义镜像</h2><p>镜像包含了应用程序、程序运行的系统函数库、运行配置等文件的文件包。构建自定义镜像就是把上述文件打包的过程。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231126100645222.png" alt="image-20231126100645222"></p>
<h3 id="镜像结构"><a href="#镜像结构" class="headerlink" title="镜像结构"></a>镜像结构</h3><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231126101316105.png" alt="image-20231126101316105"></p>
<p>分层，好处是可以共享某些基础层，不必重复构建。例如在安装了mysql镜像后，安装redis镜像，可见层<code>1f7ce2fa46ab</code>已存在。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost wallnut]<span class="comment"># docker pull redis</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/redis</span><br><span class="line">1f7ce2fa46ab: Already exists  <span class="comment">#当前层已存在</span></span><br><span class="line">3c6368585bf1: Pull complete </span><br><span class="line">3911d271d7d8: Pull complete </span><br><span class="line">ac88aa9d4021: Pull complete </span><br><span class="line">127cd75a68a2: Pull complete </span><br><span class="line">4f4fb700ef54: Pull complete </span><br><span class="line">f3993c1104fc: Pull complete </span><br><span class="line">Digest: sha256:2976bc0437deff693af2dcf081a1d1758de8b413e6de861151a5a136c25eb9e4</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:latest</span><br><span class="line">docker.io/library/redis:latest</span><br></pre></td></tr></table></figure>



<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>自定义镜像时不需要自己找，而是使用Dockerfile中的指令说明要什么操作来构建镜像。</p>
<h4 id="常见指令"><a href="#常见指令" class="headerlink" title="常见指令"></a>常见指令</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231126101454693.png" alt="image-20231126101454693"></p>
<h4 id="demo：-1"><a href="#demo：-1" class="headerlink" title="demo："></a>demo：</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231126101938554.png" alt="image-20231126101938554"></p>
<h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>有了dockerfile后，使用命令构建镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myImage:1.0 . </span><br><span class="line"><span class="comment">#docker built -t repository:tag dockerfile路径（最好是相对路径）</span></span><br></pre></td></tr></table></figure>

<h4 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h4><p>1、加载本地镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost demo]<span class="comment"># ls</span></span><br><span class="line">demo  jdk.tar  mysql.tar  nginx.tar</span><br><span class="line">[root@localhost demo]<span class="comment"># docker load -i jdk.tar</span></span><br><span class="line">2c7e7ab2260a: Loading layer  119.3MB/119.3MB</span><br><span class="line">9ad2165feb02: Loading layer  17.18MB/17.18MB</span><br><span class="line">92903c3857f8: Loading layer  17.87MB/17.87MB</span><br><span class="line">1736ab871b32: Loading layer  12.18MB/12.18MB</span><br><span class="line">6f8e4cb95a88: Loading layer  3.584kB/3.584kB</span><br><span class="line">41080a0c646f: Loading layer  141.8MB/141.8MB</span><br><span class="line">Loaded image: openjdk:11.0-jre-buster</span><br></pre></td></tr></table></figure>

<p>2、进入demo目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost demo]<span class="comment"># cd demo</span></span><br><span class="line">[root@localhost demo]<span class="comment"># docker build -t docker-demo .</span></span><br><span class="line">[+] Building 0.4s (8/8) FINISHED                                                            docker:default</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                     0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                       0.0s</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                  0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 358B                                                                  0.0s</span><br><span class="line"> =&gt; [internal] load metadata <span class="keyword">for</span> docker.io/library/openjdk:11.0-jre-buster                            0.0s</span><br><span class="line"> =&gt; [1/3] FROM docker.io/library/openjdk:11.0-jre-buster                                              0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                     0.1s</span><br><span class="line"> =&gt; =&gt; transferring context: 17.70MB                                                                  0.1s</span><br><span class="line"> =&gt; [2/3] RUN <span class="built_in">ln</span> -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span class="built_in">echo</span> Asia/Shanghai &gt; /etc/  0.2s</span><br><span class="line"> =&gt; [3/3] COPY docker-demo.jar /app.jar                                                               0.1s</span><br><span class="line"> =&gt; exporting to image                                                                                0.1s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                               0.1s</span><br><span class="line"> =&gt; =&gt; writing image sha256:ca7a0e87318bc12fbc68314cdfb4ba2b97eaea92ee4c12d88716b46c1cde27bb          0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/docker-demo                                                        0.0s</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231126103909950.png" alt="image-20231126103909950"></p>
<p>3、运行镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name docker_demo -p 8080:8080 docker-demo <span class="comment"># 8080是代码中指定的端口号，此处无需关心</span></span><br></pre></td></tr></table></figure>

<p>4、访问<code>172.31.226.34:8080</code></p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231126104206361.png" alt="image-20231126104206361"></p>
<h2 id="容器互联"><a href="#容器互联" class="headerlink" title="容器互联"></a>容器互联</h2><p><code>docker inspect 容器名</code>中的networks字段即可看到该容器的ip地址。默认情况下，所有容器以bridge方式连接到docker的一个虚拟网桥</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231127172334735.png" alt="image-20231127172334735"></p>
<p>虽然这些容器同属一个网桥，可以相互通信，但这些ip是由docker按顺序分配的，一旦docker重启，容器启动顺序改变，这些容器的ip地址可能不同，容器之间相互通信的地址要重新设置。</p>
<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><p>加入自定义网络的容器可以通过<strong>容器名</strong>互相访问</p>
<h4 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231127181037711.png" alt="image-20231127181037711"></p>
<h4 id="demo：-2"><a href="#demo：-2" class="headerlink" title="demo："></a>demo：</h4><ul>
<li>第一步：创建网络mynetwork，并使自定义镜像时创建的docker_demo容器加入网络。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">0c5ff379beb7   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">68f4a61a71b2   host      host      <span class="built_in">local</span></span><br><span class="line">b27cc43b8cba   none      null      <span class="built_in">local</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker network create mynetwork</span></span><br><span class="line">04da59f0180192d722d3846b4eaa6d7df3d4ae35df510412cf1bef9196036630</span><br><span class="line">[root@localhost mysql]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME        DRIVER    SCOPE</span><br><span class="line">0c5ff379beb7   bridge      bridge    <span class="built_in">local</span></span><br><span class="line">68f4a61a71b2   host        host      <span class="built_in">local</span></span><br><span class="line">04da59f01801   mynetwork   bridge    <span class="built_in">local</span></span><br><span class="line">b27cc43b8cba   none        null      <span class="built_in">local</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker network connect mynetwork docker_demo</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步，将nginx在运行时加入网络mynetwork</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name 镜像名 -p 8080:8080 --network 容器名</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># docker rm -f nginx</span></span><br><span class="line">nginx</span><br><span class="line">[root@localhost mysql]<span class="comment"># docker run -d --name nginx -p 80:80 --network mynetwork nginx</span></span><br><span class="line">ee0f915f6e398eaba6cc95665f23d2380492e22b02a709ad2adbf9a2a7754665</span><br></pre></td></tr></table></figure>

<ul>
<li>第三步，进入docker_demo容器执行bash，并通过容器名ping nginx</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]<span class="comment"># docker exec -it docker_demo bash</span></span><br><span class="line">root@f0e9ba9a7278:/<span class="comment"># ping nginx</span></span><br><span class="line">PING nginx (172.18.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from nginx.mynetwork (172.18.0.3): icmp_seq=1 ttl=64 time=0.191 ms</span><br><span class="line">64 bytes from nginx.mynetwork (172.18.0.3): icmp_seq=2 ttl=64 time=0.142 ms</span><br></pre></td></tr></table></figure>



<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><p>由于不是java选手，无法将java项目打包，此处暂时没做。</p>
<h2 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h2><p>通过一个单独的docker-compuse.yml模板文件定义一组相关联的应用容器，帮助我们实现多个相关联docker容器的快速部署。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231127190855534.png" alt="image-20231127190855534"></p>
<p>语法和docker run 命令几乎类似。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231127191013928.png" alt="image-20231127191013928"></p>
<h3 id="docker语法详解"><a href="#docker语法详解" class="headerlink" title="docker语法详解"></a>docker语法详解</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span>  <span class="comment"># 容器</span></span><br><span class="line">  <span class="attr">mysql:</span>   <span class="comment"># mysql 容器</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span>  <span class="comment"># 来自mysql镜像</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span> </span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/conf:/etc/mysql/conf.d&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/init:/docker-entrypoint-initdb.d&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">  <span class="attr">hmall:</span></span><br><span class="line">    <span class="attr">build:</span> </span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18080:18080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18081:18081&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/nginx.conf:/etc/nginx/nginx.conf&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/html:/usr/share/nginx/html&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line"><span class="attr">networks:</span>  <span class="comment"># 网络</span></span><br><span class="line">  <span class="attr">hm-net:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hmall</span></span><br></pre></td></tr></table></figure>

<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231127191800774.png" alt="image-20231127191800774"></p>
<h2 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><blockquote>
<p>[root@localhost &#x2F;]# docker images<br>Cannot connect to the Docker daemon at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock. Is the docker daemon running?</p>
</blockquote>
<p>解决方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/b8c525c7aadb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/b8c525c7aadb/" class="post-title-link" itemprop="url">合成大西瓜基础版本魔改+4everland部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-25 14:47:14 / 修改时间：14:49:50" itemprop="dateCreated datePublished" datetime="2023-11-25T14:47:14+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%98%E8%85%BE/" itemprop="url" rel="index"><span itemprop="name">折腾</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="合成大西瓜基础版本魔改-4everland部署"><a href="#合成大西瓜基础版本魔改-4everland部署" class="headerlink" title="合成大西瓜基础版本魔改+4everland部署"></a>合成大西瓜基础版本魔改+4everland部署</h1><p>仓库：<a target="_blank" rel="noopener" href="https://github.com/drinkwateronly/watermelon">https://github.com/drinkwateronly/watermelon</a></p>
<p>使用本仓库的代码魔改合成大西瓜的要求</p>
<ul>
<li>会运行python代码</li>
<li>会上传代码到github仓库。</li>
</ul>
<h2 id="文件概览"><a href="#文件概览" class="headerlink" title="文件概览"></a>文件概览</h2><p>下载本仓库文件后，文件如下：</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231125134155347.png" alt="image-20231125134155347"></p>
<h2 id="魔改"><a href="#魔改" class="headerlink" title="魔改"></a>魔改</h2><p><code>src/extraSetting.js</code>中按需修改，要强调的是可以修改网页标题。</p>
<h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><p>两种处理方式，本文提供python脚本自动处理。手动处理较为繁琐，请查询网络教程，或使用他人提供的在线大西瓜图片处理工具。</p>
<h3 id="自动处理"><a href="#自动处理" class="headerlink" title="自动处理"></a>自动处理</h3><p>原本水果图片文件在<code>res/raw-assets</code>的位置、图片文件名等信息已按水果尺寸从小到大记录到<code>image_process/info.xlsx</code>中，具体如下。例如樱桃图片文件为<code>res/raw-assets/0c/0cbb3dbb-2a85-42a5-be21-9839611e5af7.png</code>。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231125104727166.png" alt="image-20231125104727166"></p>
<p>定制水果图片为想要的图片，则需要将要定制的11张图片（对应11种水果）放到<code>image_process/original</code>，并按水果尺寸从小到大的顺序命名为<code>1.jpg</code>, <code>2.jpg</code>…, <code>11.jpg</code>。</p>
<p><strong>注意，这些定制图片的尺寸最好是近似正方形，以免在后续图片处理中的缩放操作导致图片被拉伸，效果变差。</strong></p>
<p>随后运行<code>image_process/demo.py</code>即可自动将这些图片修改到原本水果图片的位置。其中该python脚本将图片先缩放到对应的正方形尺寸，并裁剪成圆形。</p>
<h3 id="手动"><a href="#手动" class="headerlink" title="手动"></a>手动</h3><p>略</p>
<h2 id="本地预览"><a href="#本地预览" class="headerlink" title="本地预览"></a>本地预览</h2><ul>
<li><p>下载并安装Node</p>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/download/">http://nodejs.cn/download/</a></p>
</li>
<li><p>进入命令行，检查npm是否安装成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>命令行安装serve工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g serve</span><br></pre></td></tr></table></figure>
</li>
<li><p>从合成大西瓜文件夹进入命令行，启动serve</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serve</span><br></pre></td></tr></table></figure></li>
</ul>
<p>成功后浏览器输访问<code>localhost:5000</code>即可</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>预览没问题后，可以开始部署上线。</p>
<ul>
<li><p><strong>首先代码要上传到github仓库</strong>。</p>
</li>
<li><p>随后使用<a target="_blank" rel="noopener" href="https://dashboard.4everland.org/?invite=49TRKU2D">4everland</a>进行静态网页托管，并使用github注册即可。</p>
</li>
<li><p>注册成功后，点击<code>new project</code>，创建一个新项目</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231125111433974.png" alt="image-20231125111433974"></p>
</li>
<li><p>然后在step 1，import保存了合成大西瓜代码的github的仓库</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231125112002423.png" alt="image-20231125112002423"></p>
</li>
<li><p>step2，可选仓库的branch，意味着可以定制不同的合成大西瓜，上传到同一个仓库的不同branch管理。此处使用默认的branch，直接deploy即可。</p>
<img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231125112423795.png" alt="image-20231125112423795" style="zoom:67%;" />
</li>
<li><p>step3，耐心等待部署。完成后点击visit访问，并记录下url。首次加载该游戏可能比较慢。</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20231125112509144.png" alt="image-20231125112509144"></p>
<ul>
<li><p>拓展：</p>
<p><a target="_blank" rel="noopener" href="https://dashboard.4everland.org/?invite=49TRKU2D">4everland</a>注册就送了1G的静态网页托管空间，一个合成大西瓜也就十几m，所以合理地管理好仓库的branch，可以上线很多个合成大西瓜游戏。</p>
</li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a target="_blank" rel="noopener" href="https://docs.qq.com/sheet/DS0d2VVVJYmpvZ0pZ?tab=BB08J2">魔改大西瓜可替换的素材 (qq.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/H9VR1MWn-9bKSC_1l_MkJw">魔改和上线你的合成大西瓜，最全教程！ (qq.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vy4y1n7KW/?vd_source=9883419bb9939eb61834a63a38921b19">全网最贴心的魔改合成大西瓜教程，从修改到发布！_哔哩哔哩_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/a6aff7c01e18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/a6aff7c01e18/" class="post-title-link" itemprop="url">VMvare+CentOS7的安装+桥接模式下的静态ip设置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-23 20:05:13" itemprop="dateCreated datePublished" datetime="2023-11-23T20:05:13+08:00">2023-11-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-12-01 12:44:50" itemprop="dateModified" datetime="2023-12-01T12:44:50+08:00">2023-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="VMvare-17下载、安装、配置"><a href="#VMvare-17下载、安装、配置" class="headerlink" title="VMvare 17下载、安装、配置"></a>VMvare 17下载、安装、配置</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45037155/article/details/123589403">https://blog.csdn.net/qq_45037155/article/details/123589403</a></p>
<p>如果本机以前安装过，安装前要把原来的vmvare的注册表信息清空。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</a></p>
<p>密钥：MC60H-DWHD5-H80U9-6V85M-8280D</p>
<p>配置：内存8g，4核CPU</p>
<h2 id="centos-7下载与设置"><a href="#centos-7下载与设置" class="headerlink" title="centos 7下载与设置"></a>centos 7下载与设置</h2><h3 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h3><p><a target="_blank" rel="noopener" href="https://mirrors6.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/">https://mirrors6.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/</a></p>
<p>电脑配置够可以不装mini版本，因为缺失了一些基本功能比如ifconfig，再安装浪费时间。</p>
<h3 id="centOS设置静态ip"><a href="#centOS设置静态ip" class="headerlink" title="centOS设置静态ip"></a>centOS设置静态ip</h3><p>此处不止要设置静态ip，还要将虚拟机的ip归属到主机ip所属的子网，它们之间可以相互ping通。</p>
<h4 id="获取windows主机子网、网关信息"><a href="#获取windows主机子网、网关信息" class="headerlink" title="获取windows主机子网、网关信息"></a>获取windows主机子网、网关信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123194830334.png" alt="image-20231123194830334"></p>
<p>网关、子网掩码显而易见，子网为<code>172.31.226.0</code></p>
<h4 id="VMware网络模式简单了解"><a href="#VMware网络模式简单了解" class="headerlink" title="VMware网络模式简单了解"></a>VMware网络模式简单了解</h4><ul>
<li><p>桥接模式（本文选择）<br>桥接模式就是将虚拟机的虚拟网卡利用虚拟网桥与主机的物理网卡进行通信。这时虚拟机与物理主机就相当于在同一个局域网内，它们所使用的IP 地址也是同一个网段，与在办公室里多安装了一台电脑一样，分配给它的IP 与这个局域网内的其它IP 相同会引起冲突，这种方式适用于IP 地址分配较为宽裕的网络环境。</p>
</li>
<li><p>主机共享模式<br>虚拟机通过VMnet1 虚拟网卡直接与主机的网卡进行通信，这种方式将虚拟机与外网隔离，只可以通过物理主机来访问虚拟机资源，而虚拟机也不可以访问互联网的资源，这种模式适用于复杂的网络环境进行学习和测试使用</p>
</li>
<li><p>NAT模式（原本选择，本文暂未解决NAT模式下的静态ip）<br>在NAT 模式中，主机网卡直接与虚拟机的虚拟NAT 设备相连接，然后虚拟机的NAT 设备与虚拟机的虚拟DHCP 服务器一起连接到虚拟网卡VMnet8 上。这时虚拟机与物理主机就不在同一个局域网内，它主要是通过VMnet8 虚拟网卡与主机进行通信，这种方式适用于IP 地址分配较为紧张的网络环境。</p>
</li>
</ul>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44654974/article/details/127347478">https://blog.csdn.net/qq_44654974/article/details/127347478</a></p>
<h4 id="vmvare设置"><a href="#vmvare设置" class="headerlink" title="vmvare设置"></a>vmvare设置</h4><p>右键centOS&gt;设置&gt;网络适配器&gt;桥接模式 即可</p>
<p><em><strong>以下步骤是NAT模式下设置的，虚拟机可以ping通外网，但发现虚拟机并不能被主机ping通</strong></em></p>
<p><del>编辑&gt;虚拟网络编辑器&gt;VMnet8，设置子网IP+子网掩码</del> </p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123195029701.png" alt="image-20231123195029701"></p>
<p><del>然后进入NAT设置，设置网关</del></p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231123195215541.png" alt="image-20231123195215541"></p>
<h4 id="CentOS设置"><a href="#CentOS设置" class="headerlink" title="CentOS设置"></a>CentOS设置</h4><p>随后进入CentOS，查看网卡名称，确定哪个网卡用于静态ip。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br></pre></td></tr></table></figure>

<p>随后进入CentOS，进入网卡文件配置目录，编辑网卡ens33对应文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span>  /etc/sysconfig/network-scripts</span><br><span class="line">vim ifcfg-ens33</span><br></pre></td></tr></table></figure>

<p>根据前几步所涉及的子网、子网掩码、网关信息，新增&#x2F;修改如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BOOTRPROTO=&quot;static&quot;  // none/static表示静态网卡，通常是dhcp即动态分配</span><br><span class="line">ONBOOT=&quot;yes</span><br><span class="line"></span><br><span class="line">IPADDR=172.31.226.34  // 一个未被使用的ip地址，属于子网172.31.226.0即可</span><br><span class="line">NETMASK=225.225.225.0  // 子网掩码</span><br><span class="line">172.31.226.33         // 网关</span><br><span class="line">DNS1=114.114.114.114  // 电信DNS服务器，可修改为其他</span><br><span class="line">DNS2=8.8.8.8          // 谷歌DNS服务器，可修改为其他</span><br></pre></td></tr></table></figure>



<p>重启执行网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<p>使用ping检测网络连接是否正常，并检查ip地址是否是自己配置的那个地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping baidu.com</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p>虚拟机和主机相互ping检查是否正常。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="ens33网卡不见"><a href="#ens33网卡不见" class="headerlink" title="ens33网卡不见"></a>ens33网卡不见</h3><p>解决方式：重启网络服务即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop NetworkManager</span><br><span class="line">systemctl <span class="built_in">disable</span> NetworkManager</span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<h3 id="ens网卡没有ipv4地址"><a href="#ens网卡没有ipv4地址" class="headerlink" title="ens网卡没有ipv4地址"></a>ens网卡没有ipv4地址</h3><p>这时候问题比较奇怪，网卡配置文件已经配置成了静态网卡，但是ifconfig命令中ens33网卡只显示inet6地址，没有找到比较好的解决方案。</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231201102733496.png" alt="image-20231201102733496"></p>
<p>临时的解决方案，在重启网络&#x2F;重启机器后，会失效，要重新设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens33 172.31.226.34</span><br></pre></td></tr></table></figure>

<p>最后是将<code>/etc/sysconfig/network-scripts/ifcfg-ens33</code>文件重写了才解决。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static </span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33    </span><br><span class="line">UUID=f5e37a10-3da9-47af-8dbb-370b7bf24509</span><br><span class="line">DEVICE=ens33  </span><br><span class="line">ONBOOT=yes  </span><br><span class="line">IPADDR=172.31.226.34    </span><br><span class="line">GATEWAY=172.31.226.33    </span><br><span class="line">NETMASK=255.255.255.0   </span><br><span class="line">DNS1=114.114.114.114  </span><br><span class="line">DNS2=8.8.8.8</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/e719517baf70/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/e719517baf70/" class="post-title-link" itemprop="url">有用的站点</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-23 20:05:00 / 修改时间：20:09:23" itemprop="dateCreated datePublished" datetime="2023-11-23T20:05:00+08:00">2023-11-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>清华镜像</p>
<p><a target="_blank" rel="noopener" href="http://mirrors.tuna.tsinghua.edu.cn/">http://mirrors.tuna.tsinghua.edu.cn/</a> (IPv4+IPv6)</p>
<p><a target="_blank" rel="noopener" href="http://mirrors.6.tuna.tsinghua.edu.cn/">http://mirrors.6.tuna.tsinghua.edu.cn/</a>  (IPv6 only)</p>
<p><a target="_blank" rel="noopener" href="http://mirrors.4.tuna.tsinghua.edu.cn/">http://mirrors.4.tuna.tsinghua.edu.cn/</a> (IPv4 only)</p>
<p>我告诉你（windows工具站</p>
<p><a target="_blank" rel="noopener" href="https://msdn.itellyou.cn/?ang=2h-cn">https://msdn.itellyou.cn/?ang=2h-cn</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/21af1bc8b692/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/21af1bc8b692/" class="post-title-link" itemprop="url">MySQL报错与解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-17 19:21:00 / 修改时间：20:01:15" itemprop="dateCreated datePublished" datetime="2023-11-17T19:21:00+08:00">2023-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="错误1"><a href="#错误1" class="headerlink" title="错误1"></a>错误1</h1><h2 id="报错内容"><a href="#报错内容" class="headerlink" title="报错内容"></a>报错内容</h2><p>无法往mysql中插入 0000-00-00 00:00:00的空时间</p>
<blockquote>
<p>Error 1292 (22007): Incorrect datetime value: ‘0000-00-00’ for column ‘login_time’ at row 1 [9.386ms] [rows:0] INSERT INTO <code>user_basic</code> (<code>created_at</code>,<code>updated_at</code>,<code>deleted_at</code>,<code>name</code>,<code>password</code>,<code>phone</code>,<code>email</code>,<code>identity</code>,<code>client_ip</code>,<code>client_port</code>,<code>login_time</code>,<code>heartbeat_time</code>,<code>login_out_time</code>,<code>is_login_out</code>,<code>device_info</code>) VALUES (‘2023-09-05 10:04:15.45’,’2023-09-05 10:04:15.45’,NULL,’chenjie’,’’,’’,’’,’’,’’,’’,’0000-00-00 00:00:00’,’0000-00-00 00:00:00’,’0000-00-00 00:00:00’,false,’’)</p>
</blockquote>
<h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;sql_mode&#x27;;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------------+-----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Variable_name | Value                                                                                                                 |</span><br><span class="line">+---------------+-----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| sql_mode      | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+---------------+-----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>可以看到sql_mode字段有NO_ZERO_IN_DATE，NO_ZERO_DATE，都删除即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global sql_mode=&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27;;</span><br></pre></td></tr></table></figure>



<h1 id="错误2"><a href="#错误2" class="headerlink" title="错误2"></a>错误2</h1><h2 id="错误内容："><a href="#错误内容：" class="headerlink" title="错误内容："></a>错误内容：</h2><blockquote>
<p>SQL_ERROR_INFO: “Expression #3 of SELECT list is not in GROUP BY clause and contains nonaggregated column ‘practice_record.submit_time’ which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode&#x3D;only_full_group_by”</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f6b4770f453d4163acc419e3d19e6746?tpId=240&tqId=2183006&ru=/exam/oj&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj">月总刷题数和日均刷题数_牛客题霸_牛客网 (nowcoder.com)</a></p>
<blockquote>
<p>ONLY_FULL_GROUP_BY的语义就是确定select list中的值要么是来自于聚合函数（sum、avg、max等）的结果，要么是来自于group by list中的表达式的值，在计算日均刷题数的时候，使用了day( last_day( submit_time))，这个数据是临时定义的，它即不来自聚合函数又不来自group by list，所以会报错。</p>
</blockquote>
<h2 id="解决方式-1"><a href="#解决方式-1" class="headerlink" title="解决方式"></a>解决方式</h2><p>MySQL提供了 <strong>any_value()</strong> 函数来抑制ONLY_FULL_GROUP_BY值被拒绝</p>
<p>any_value()会选择被分到同一组的数据里第一条数据的指定列值作为返回数据。在计算日均刷题数的时候，选择submit_month作为返回数据，这样就忽略了分母中的day( last_day( submit_time))，从而避免ONLY_FULL_GROUP_BY 报错。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/0d12653e139c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/0d12653e139c/" class="post-title-link" itemprop="url">基础教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-17 19:21:00 / 修改时间：19:35:57" itemprop="dateCreated datePublished" datetime="2023-11-17T19:21:00+08:00">2023-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>DBMS - （执行）-&gt; SQL -(操作) -&gt; DB</p>
<p>增删改查 CRUD: create retrieve update delete</p>
<h1 id="表："><a href="#表：" class="headerlink" title="表："></a>表：</h1><ul>
<li>行-数据&#x2F;记录 data</li>
<li>列：字段<ul>
<li>每个字段包括：字段名、数据类型、约束</li>
</ul>
</li>
</ul>
<p>	</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; mysql -uroot -p123  // 登录mysql</span><br><span class="line">mysql&gt; show databases;  // 查看有哪些数据库</span><br><span class="line">mysql&gt; create database database1; // 创建数据库</span><br><span class="line">mysql&gt; use database1;  // 使用该数据库</span><br><span class="line">mysql&gt; show tables;  // 查看有哪些表</span><br><span class="line">mysql&gt; sources  E:\BaiduNetdiskDownload\05-MySQL\bjpowernode.sql // 导入文件</span><br><span class="line">mysql&gt; drop database database1</span><br></pre></td></tr></table></figure>

<p>表结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_dljd |</span><br><span class="line">+----------------+</span><br><span class="line">| dept           |</span><br><span class="line">| emp            |</span><br><span class="line">| salgrade       |</span><br><span class="line">+----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc dept;</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type        | Null | Key | Default | Extra |</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">| DEPTNO | int         | NO   | PRI | NULL    |       | # 部门编号</span><br><span class="line">| DNAME  | varchar(14) | YES  |     | NULL    |       | # 部门名</span><br><span class="line">| LOC    | varchar(13) | YES  |     | NULL    |       | # 部门位置</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| EMPNO    | int         | NO   | PRI | NULL    |       |</span><br><span class="line">| ENAME    | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">| JOB      | varchar(9)  | YES  |     | NULL    |       |</span><br><span class="line">| MGR      | int         | YES  |     | NULL    |       |</span><br><span class="line">| HIREDATE | date        | YES  |     | NULL    |       |</span><br><span class="line">| SAL      | double(7,2) | YES  |     | NULL    |       |</span><br><span class="line">| COMM     | double(7,2) | YES  |     | NULL    |       |</span><br><span class="line">| DEPTNO   | int         | YES  |     | NULL    |       |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc salgrade;</span><br><span class="line">+-------+------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+-------+------+------+-----+---------+-------+</span><br><span class="line">| GRADE | int  | YES  |     | NULL    |       | # 薪资等级</span><br><span class="line">| LOSAL | int  | YES  |     | NULL    |       |</span><br><span class="line">| HISAL | int  | YES  |     | NULL    |       | # 最高薪资</span><br><span class="line">+-------+------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>查看创建该表时的语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table salgrade;</span><br><span class="line">#-----------------------------------------</span><br><span class="line">CREATE TABLE `salgrade` (</span><br><span class="line">  `GRADE` int DEFAULT NULL,</span><br><span class="line">  `LOSAL` int DEFAULT NULL,</span><br><span class="line">  `HISAL` int DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br></pre></td></tr></table></figure>

<h1 id="sql-语句"><a href="#sql-语句" class="headerlink" title="sql 语句"></a>sql 语句</h1><h2 id="SQL语句分类"><a href="#SQL语句分类" class="headerlink" title="SQL语句分类"></a>SQL语句分类</h2><ul>
<li>DQL（数据查询语言）：查询语句</li>
<li>DML（数据操作语言）：增删改查</li>
<li>DDL（数据定义语言）：对表结构增删改查</li>
<li>TCL （事务控制语言）：commit提交事务，rollback回滚事务</li>
<li>DCL（数据控制语言）：grant授权、revoke撤销授权</li>
</ul>
<p>不区分大小写</p>
<h2 id="查询语句"><a href="#查询语句" class="headerlink" title="查询语句"></a>查询语句</h2><p>基础用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select field_name1, field_name2 from table_name;</span><br><span class="line">select * from table_name; # 开发中不建议使用，效率低</span><br></pre></td></tr></table></figure>

<p>字段参与运算</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select field_name1 * 12 as field_name3, field_name2 from table_name;</span><br><span class="line">select ename, sal * 12 as yearsal from emp;  # as 可省略</span><br><span class="line">select ename, sal * 12 as &#x27;年薪&#x27; from emp;  # 单引号括起作为字符串，不要用双引号，因为不通用</span><br></pre></td></tr></table></figure>

<p>条件查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select ename from emp where sal = 5000;</span><br><span class="line">select sal from emp where ename = &#x27;king&#x27;;</span><br><span class="line">select ename from emp where sal &lt;&gt; 5000;  # 不等于号 也可以用!=</span><br><span class="line">select ename from emp where sal &gt;= 1000 and sal &lt;= 3000;</span><br><span class="line">select ename from emp where sal between 1000 and 3000;  # 闭区间，且左小右大</span><br><span class="line">select ename from emp where ename between &#x27;A&#x27; and &#x27;B&#x27;;  # 左闭右开，只比了第一个字符</span><br></pre></td></tr></table></figure>

<ul>
<li><p>null不是值，条件查询时不能用等号，只能用<code>is null</code>或<code>is not null</code>，虽然TURNER的comm是0，但不为null	</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename, comm from emp where comm is not null;</span><br><span class="line">+--------+---------+</span><br><span class="line">| ename  | comm    |</span><br><span class="line">+--------+---------+</span><br><span class="line">| ALLEN  |  300.00 |</span><br><span class="line">| WARD   |  500.00 |</span><br><span class="line">| MARTIN | 1400.00 |</span><br><span class="line">| TURNER |    0.00 |</span><br><span class="line">+--------+---------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>and优先级大于or，也可以使用小括号给小括号。</p>
</li>
<li><p>in  等同于 or，判断 in 后的的几种值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select ename from emp where sal = 1000 and sal = 3000;</span><br><span class="line">select ename from emp where sal in (1000, 3000, 2000);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="模糊查询Like"><a href="#模糊查询Like" class="headerlink" title="模糊查询Like"></a>模糊查询Like</h3><ul>
<li>%：表示任意多个字符</li>
<li>_：表示任意一个字符</li>
<li>也可以使用转义字符，查询以上两个字符本身。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename from emp where ename like &#x27;%o%&#x27;; # 找到名字带o的</span><br><span class="line">+-------+</span><br><span class="line">| ename |</span><br><span class="line">+-------+</span><br><span class="line">| JONES |</span><br><span class="line">| SCOTT |</span><br><span class="line">| FORD  |</span><br><span class="line">+-------+</span><br><span class="line">mysql&gt; select ename from emp where ename like &#x27;_A%&#x27;; # 找到名字第二个字母为a的</span><br><span class="line">+--------+</span><br><span class="line">| ename  |</span><br><span class="line">+--------+</span><br><span class="line">| WARD   |</span><br><span class="line">| MARTIN |</span><br><span class="line">| JAMES  |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>

<h3 id="数据排序-order-by"><a href="#数据排序-order-by" class="headerlink" title="数据排序 order by"></a>数据排序 order by</h3><p>注意：排序发生在分组之后。</p>
<p>升序asc（默认） &#x2F; 降序desc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 默认升序</span><br><span class="line">mysql&gt; select ename,sal from emp order by sal;</span><br><span class="line"># 关键词指定升序降序</span><br><span class="line">mysql&gt; select ename,sal from emp order by sal asc;</span><br><span class="line">mysql&gt; select ename,sal from emp order by sal desc;</span><br><span class="line"># 分段排序，先升序排序sal，若sal相同，则降序排序asc。</span><br><span class="line">select ename,sal from emp order by sal, ename asc;</span><br><span class="line">+--------+---------+</span><br><span class="line">| ename  | sal     |</span><br><span class="line">+--------+---------+</span><br><span class="line">| SMITH  |  800.00 |</span><br><span class="line">| JAMES  |  950.00 |</span><br><span class="line">| ADAMS  | 1100.00 |</span><br><span class="line">| MARTIN | 1250.00 |</span><br><span class="line">| WARD   | 1250.00 |</span><br><span class="line">| MILLER | 1300.00 |</span><br><span class="line">| TURNER | 1500.00 |</span><br><span class="line">| ALLEN  | 1600.00 |</span><br><span class="line">| CLARK  | 2450.00 |</span><br><span class="line">| BLAKE  | 2850.00 |</span><br><span class="line">| JONES  | 2975.00 |</span><br><span class="line">| FORD   | 3000.00 |</span><br><span class="line">| SCOTT  | 3000.00 |</span><br><span class="line">| KING   | 5000.00 |</span><br><span class="line">+--------+---------+</span><br><span class="line"># 先from 后 where 最后 order</span><br><span class="line">select ename, sal from emp where job = &#x27;salesman&#x27; order by sal desc;</span><br><span class="line"># 验证执行顺序</span><br><span class="line">select ename, job, sal as salary from emp where job = &#x27;salesman&#x27; order by salary desc;</span><br></pre></td></tr></table></figure>

<h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3><p><strong>分组函数会自动忽略null</strong>。又称为多行执行函数，输入多行输出一行，只有如下五种：</p>
<ul>
<li>sum</li>
<li>avg</li>
<li>max&#x2F;min</li>
<li>count</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(*) from emp; #</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|       14 |</span><br><span class="line">+----------+</span><br><span class="line"># 分组函数自动忽略null，所以count(comm)只有4个。</span><br><span class="line">mysql&gt; select count(comm), sum(comm), avg(comm) from emp;</span><br><span class="line">+-------------+-----------+------------+</span><br><span class="line">| count(comm) | sum(comm) | avg(comm)  |</span><br><span class="line">+-------------+-----------+------------+</span><br><span class="line">|           4 |   2200.00 | 550.000000 |</span><br><span class="line">+-------------+-----------+------------+</span><br><span class="line"># 多余的操作：</span><br><span class="line">mysql&gt; select count(comm) from emp where comm is not null;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>区别</p>
<ul>
<li><code>count(comm)</code>统计某个字段的非空数据。</li>
<li><code>count(*)</code>一定是统计总记录条数，而不是某个字段中数据的个数，即与某字段无关，即使为所有字段值都为null。</li>
</ul>
<p>单行处理函数中null的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># 任何数据库，null参与数据运算，最后结果都是null</span><br><span class="line">mysql&gt; select ename, (sal+comm) * 12 as yearsal from emp;</span><br><span class="line">+--------+----------+</span><br><span class="line">| ename  | yearsal  |</span><br><span class="line">+--------+----------+</span><br><span class="line">| SMITH  |     NULL |</span><br><span class="line">| ALLEN  | 22800.00 |</span><br><span class="line">| WARD   | 21000.00 |</span><br><span class="line">| JONES  |     NULL |</span><br><span class="line">| MARTIN | 31800.00 |</span><br><span class="line">| BLAKE  |     NULL |</span><br><span class="line">| CLARK  |     NULL |</span><br><span class="line">| SCOTT  |     NULL |</span><br><span class="line">| KING   |     NULL |</span><br><span class="line">| TURNER | 18000.00 |</span><br><span class="line">| ADAMS  |     NULL |</span><br><span class="line">| JAMES  |     NULL |</span><br><span class="line">| FORD   |     NULL |</span><br><span class="line">| MILLER |     NULL |</span><br><span class="line">+--------+----------+</span><br><span class="line"># 解决方式，ifnull()函数</span><br><span class="line">	# 用法：ifnull(可能是空的数据，若是空被替换的数据)</span><br><span class="line">mysql&gt; select ename, (sal+ifnull(comm,0)) * 12 as yearsal from emp;</span><br><span class="line">+--------+----------+</span><br><span class="line">| ename  | yearsal  |</span><br><span class="line">+--------+----------+</span><br><span class="line">| SMITH  |  9600.00 |</span><br><span class="line">| ALLEN  | 22800.00 |</span><br><span class="line">| WARD   | 21000.00 |</span><br><span class="line">| JONES  | 35700.00 |</span><br><span class="line">| MARTIN | 31800.00 |</span><br><span class="line">| BLAKE  | 34200.00 |</span><br><span class="line">| CLARK  | 29400.00 |</span><br><span class="line">| SCOTT  | 36000.00 |</span><br><span class="line">| KING   | 60000.00 |</span><br><span class="line">| TURNER | 18000.00 |</span><br><span class="line">| ADAMS  | 13200.00 |</span><br><span class="line">| JAMES  | 11400.00 |</span><br><span class="line">| FORD   | 36000.00 |</span><br><span class="line">| MILLER | 15600.00 |</span><br><span class="line">+--------+----------+</span><br></pre></td></tr></table></figure>

<h4 id="group-by-和-having"><a href="#group-by-和-having" class="headerlink" title="group by 和 having"></a>group by 和 having</h4><ul>
<li>group by： 按照某个&#x2F;些字段进行分组</li>
<li>having：对分组后的数据再次过滤，<ul>
<li><u>作用和where类似，但having一定和group by一起用。</u></li>
<li><u>where在group by执行前执行，having则在group by执行后执行。</u></li>
<li><u>为了效率尽量使用where先过滤 而非having后过滤。</u></li>
</ul>
</li>
</ul>
<h5 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h5><p><em><u>当一条语句有group by分组，select后只能跟分组函数和参与分组的字段</u>。</em></p>
<p>见问题与解决方法.md文件的错误2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个工作岗位的最高薪资</span><br><span class="line">mysql&gt; select max(sal), job from emp group by job;</span><br><span class="line">+----------+-----------+</span><br><span class="line">| max(sal) | job       |</span><br><span class="line">+----------+-----------+</span><br><span class="line">|  1300.00 | CLERK     |</span><br><span class="line">|  1600.00 | SALESMAN  |</span><br><span class="line">|  2975.00 | MANAGER   |</span><br><span class="line">|  3000.00 | ANALYST   |</span><br><span class="line">|  5000.00 | PRESIDENT |</span><br><span class="line">+----------+-----------+</span><br><span class="line"></span><br><span class="line"># 找出每个工作岗位的最高薪资, 多查询了ename字段，Oracle会报错，mysql可执行但无意义，数据是错误的（此处新版本会报错）</span><br><span class="line">mysql&gt; select ename, max(sal), job from emp group by job;</span><br><span class="line"># 当一条语句有group by，select后只能跟分组函数和参与分组的字段。</span><br></pre></td></tr></table></figure>

<p>多个字段联合分组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno, job, sal from emp order by deptno, job;</span><br><span class="line">+--------+-----------+---------+</span><br><span class="line">| deptno | job       | sal     |</span><br><span class="line">+--------+-----------+---------+</span><br><span class="line">|     10 | CLERK     | 1300.00 |</span><br><span class="line">|     10 | MANAGER   | 2450.00 |</span><br><span class="line">|     10 | PRESIDENT | 5000.00 |</span><br><span class="line">|     20 | ANALYST   | 3000.00 |</span><br><span class="line">|     20 | ANALYST   | 3000.00 |</span><br><span class="line">|     20 | CLERK     |  800.00 |</span><br><span class="line">|     20 | CLERK     | 1100.00 |</span><br><span class="line">|     20 | MANAGER   | 2975.00 |</span><br><span class="line">|     30 | CLERK     |  950.00 |</span><br><span class="line">|     30 | MANAGER   | 2850.00 |</span><br><span class="line">|     30 | SALESMAN  | 1600.00 |</span><br><span class="line">|     30 | SALESMAN  | 1250.00 |</span><br><span class="line">|     30 | SALESMAN  | 1250.00 |</span><br><span class="line">|     30 | SALESMAN  | 1500.00 |</span><br><span class="line">+--------+-----------+---------+</span><br><span class="line"># 找出每个部门deptno中，不同工作岗位job最高薪资</span><br><span class="line">mysql&gt; select deptno, job, max(sal) from emp group by deptno,job order by deptno, job;</span><br><span class="line">+--------+-----------+----------+</span><br><span class="line">| deptno | job       | max(sal) |</span><br><span class="line">+--------+-----------+----------+</span><br><span class="line">|     10 | CLERK     |  1300.00 |</span><br><span class="line">|     10 | MANAGER   |  2450.00 |</span><br><span class="line">|     10 | PRESIDENT |  5000.00 |</span><br><span class="line">|     20 | ANALYST   |  3000.00 |</span><br><span class="line">|     20 | CLERK     |  1100.00 |</span><br><span class="line">|     20 | MANAGER   |  2975.00 |</span><br><span class="line">|     30 | CLERK     |   950.00 |</span><br><span class="line">|     30 | MANAGER   |  2850.00 |</span><br><span class="line">|     30 | SALESMAN  |  1600.00 |</span><br><span class="line">+--------+-----------+----------+</span><br></pre></td></tr></table></figure>

<h5 id="having"><a href="#having" class="headerlink" title="having"></a>having</h5><p>为了过滤分组后的数据而存在，不可以单独出现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个部分的最高薪资，要求显示薪资大于2900的数据</span><br><span class="line"># having</span><br><span class="line">mysql&gt; select max(sal), deptno from emp group by deptno having max(sal) &gt; 2900;</span><br><span class="line">+----------+--------+</span><br><span class="line">| max(sal) | deptno |</span><br><span class="line">+----------+--------+</span><br><span class="line">|  3000.00 |     20 |</span><br><span class="line">|  5000.00 |     10 |</span><br><span class="line">+----------+--------+</span><br><span class="line"># where</span><br><span class="line">mysql&gt; select max(sal), deptno from emp where sal &gt; 2900 group by deptno;</span><br><span class="line">+----------+--------+</span><br><span class="line">| max(sal) | deptno |</span><br><span class="line">+----------+--------+</span><br><span class="line">|  3000.00 |     20 |</span><br><span class="line">|  5000.00 |     10 |</span><br><span class="line">+----------+--------+</span><br></pre></td></tr></table></figure>

<ul>
<li>此处having效率比where低，因为where对过滤的数据分组，再执行分组函数；而having执行了分组函数后，才进行过滤。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个部门的平均薪资，要求显示薪资大于2000的数据</span><br><span class="line">mysql&gt; select avg(sal), deptno from emp group by deptno having avg(sal) &gt; 2000;</span><br><span class="line">+-------------+--------+</span><br><span class="line">| avg(sal)    | deptno |</span><br><span class="line">+-------------+--------+</span><br><span class="line">| 2175.000000 |     20 |</span><br><span class="line">| 2916.666667 |     10 |</span><br><span class="line">+-------------+--------+</span><br></pre></td></tr></table></figure>

<ul>
<li>此处只能用having，而无法使用where过滤，原因如下：</li>
</ul>
<h5 id="分组函数不能直接使用在where语句。"><a href="#分组函数不能直接使用在where语句。" class="headerlink" title="分组函数不能直接使用在where语句。"></a><strong>分组函数不能直接使用在where语句。</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 找出工资大于平均工资的员工</span><br><span class="line">select ename, sal from emp where sal &gt; avg(sal);  # ERROR 1111 (HY000): Invalid use of group function</span><br></pre></td></tr></table></figure>

<p>原因：</p>
<ul>
<li>执行顺序为：where-&gt;group by-&gt;分组函数，<strong>分组函数一般都会和group by 联合使用，并在group by执行后执行</strong>，可以认为没用group by时，整张表也会使用一个默认的group by自成一组。所以where内不能用分组函数，因为还没有group by分组。</li>
</ul>
<p>解决方法：使用子查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 找出工资大于平均工资的员工</span><br><span class="line">mysql&gt; select ename, sal from emp where sal &gt; (select avg(sal) from emp);</span><br><span class="line">+-------+---------+</span><br><span class="line">| ename | sal     |</span><br><span class="line">+-------+---------+</span><br><span class="line">| JONES | 2975.00 |</span><br><span class="line">| BLAKE | 2850.00 |</span><br><span class="line">| CLARK | 2450.00 |</span><br><span class="line">| SCOTT | 3000.00 |</span><br><span class="line">| KING  | 5000.00 |</span><br><span class="line">| FORD  | 3000.00 |</span><br><span class="line">+-------+---------+</span><br></pre></td></tr></table></figure>

<h3 id="去重distinct"><a href="#去重distinct" class="headerlink" title="去重distinct"></a>去重distinct</h3><p>只能出现在所有字段最前面，表示对后面的字段联合去重，联合起来的字段一起相同才会被去除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct job from emp;</span><br><span class="line">+-----------+</span><br><span class="line">| job       |</span><br><span class="line">+-----------+</span><br><span class="line">| CLERK     |</span><br><span class="line">| SALESMAN  |</span><br><span class="line">| MANAGER   |</span><br><span class="line">| ANALYST   |</span><br><span class="line">| PRESIDENT |</span><br><span class="line">+-----------+</span><br><span class="line"># distinct 只能出现在所有字段最前面，表示对后面的字段联合去重</span><br><span class="line">mysql&gt; select distinct deptno, job from emp order by deptno;</span><br><span class="line">+--------+-----------+</span><br><span class="line">| deptno | job       |</span><br><span class="line">+--------+-----------+</span><br><span class="line">|     10 | CLERK     |</span><br><span class="line">|     10 | MANAGER   |</span><br><span class="line">|     10 | PRESIDENT |</span><br><span class="line">|     20 | ANALYST   |</span><br><span class="line">|     20 | CLERK     |</span><br><span class="line">|     20 | MANAGER   |</span><br><span class="line">|     30 | CLERK     |</span><br><span class="line">|     30 | MANAGER   |</span><br><span class="line">|     30 | SALESMAN  |</span><br><span class="line">+--------+-----------+</span><br><span class="line"># 统计岗位的数量，distinct输出是多行，所以可以直接交给分组函数</span><br><span class="line">mysql&gt; select count(distinct job) from emp;</span><br><span class="line">+---------------------+</span><br><span class="line">| count(distinct job) |</span><br><span class="line">+---------------------+</span><br><span class="line">|                   5 |</span><br><span class="line">+---------------------+ </span><br></pre></td></tr></table></figure>



<h2 id="cast"><a href="#cast" class="headerlink" title="cast"></a>cast</h2><p>CAST函数用于将值从一种数据类型转换为表达式中指定的另一种数据类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CAST(value AS datatype)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20230914000048586.png" alt="image-20230914000048586"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT CAST(&#x27;2022-04-27&#x27; AS DATETIME); </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>实际开发中一般是多表联合查询出最终的结果</p>
<h3 id="连接查询分类"><a href="#连接查询分类" class="headerlink" title="连接查询分类"></a>连接查询分类</h3><ul>
<li>语法<ul>
<li>SQL92</li>
<li>SQL99</li>
</ul>
</li>
<li>连接方式<ul>
<li>内连接<ul>
<li>等值连接</li>
<li>非等值连接</li>
<li>自连接</li>
</ul>
</li>
<li>外连接<ul>
<li>左外&#x2F;左连接</li>
<li>右外&#x2F;有链接</li>
</ul>
</li>
<li>全连接（很少用</li>
</ul>
</li>
</ul>
<p>表连接的现象：笛卡尔积现象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 两张表联合查询没有限制条件，结果的条数是两张表条 数的乘积</span><br><span class="line">mysql&gt; select ename,dname from emp,dept;</span><br></pre></td></tr></table></figure>

<p>避免笛卡尔积现象的直接方式是使用条件过滤，但不会减少记录的匹配次数，只会显示有效的记录。</p>
<p>此外此处使用了表的别名，执行效率高，可读性高</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个员工的姓名与部门名</span><br><span class="line">mysql&gt; select e.ename, d.dname from emp e, dept d where e.deptno = d.deptno;  #sql92写法，不使用</span><br><span class="line">+--------+------------+</span><br><span class="line">| ename  | dname      |</span><br><span class="line">+--------+------------+</span><br><span class="line">| SMITH  | RESEARCH   |</span><br><span class="line">| ALLEN  | SALES      |</span><br><span class="line">| WARD   | SALES      |</span><br><span class="line">| JONES  | RESEARCH   |</span><br><span class="line">| MARTIN | SALES      |</span><br><span class="line">| BLAKE  | SALES      |</span><br><span class="line">| CLARK  | ACCOUNTING |</span><br><span class="line">| SCOTT  | RESEARCH   |</span><br><span class="line">| KING   | ACCOUNTING |</span><br><span class="line">| TURNER | SALES      |</span><br><span class="line">| ADAMS  | RESEARCH   |</span><br><span class="line">| JAMES  | SALES      |</span><br><span class="line">| FORD   | RESEARCH   |</span><br><span class="line">| MILLER | ACCOUNTING |</span><br><span class="line">+--------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>



<h3 id="内连接——等值连接：条件是等量关系"><a href="#内连接——等值连接：条件是等量关系" class="headerlink" title="内连接——等值连接：条件是等量关系"></a>内连接——等值连接：条件是等量关系</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> # sql99语法，where和连接的条件分离了，更常用</span><br><span class="line"> # 语法： mysql&gt; ... A join B on 连接条件 where ...</span><br><span class="line">mysql&gt; select e.ename, d.dname from emp e join dept d on e.deptno = d.deptno;</span><br><span class="line"> # inner可以省略，带着inner可读性更好</span><br><span class="line">mysql&gt; select e.ename, d.dname from emp e inner join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>

<h3 id="内连接——非等值连接"><a href="#内连接——非等值连接" class="headerlink" title="内连接——非等值连接"></a>内连接——非等值连接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个员工的工资等级，要求显示员工名，工资，工资等级</span><br><span class="line">mysql&gt; select e.ename,e.sal,s.grade from emp e inner join salgrade s on e.sal between s.losal and s.hisal;</span><br><span class="line">+--------+---------+-------+</span><br><span class="line">| ename  | sal     | grade |</span><br><span class="line">+--------+---------+-------+</span><br><span class="line">| SMITH  |  800.00 |     1 |</span><br><span class="line">| ALLEN  | 1600.00 |     3 |</span><br><span class="line">| WARD   | 1250.00 |     2 |</span><br><span class="line">| JONES  | 2975.00 |     4 |</span><br><span class="line">| MARTIN | 1250.00 |     2 |</span><br><span class="line">| BLAKE  | 2850.00 |     4 |</span><br><span class="line">| CLARK  | 2450.00 |     4 |</span><br><span class="line">| SCOTT  | 3000.00 |     4 |</span><br><span class="line">| KING   | 5000.00 |     5 |</span><br><span class="line">| TURNER | 1500.00 |     3 |</span><br><span class="line">| ADAMS  | 1100.00 |     1 |</span><br><span class="line">| JAMES  |  950.00 |     1 |</span><br><span class="line">| FORD   | 3000.00 |     4 |</span><br><span class="line">| MILLER | 1300.00 |     2 |</span><br><span class="line">+--------+---------+-------+</span><br></pre></td></tr></table></figure>

<h3 id="自连接：一张表看成两张表，自己连接自己。"><a href="#自连接：一张表看成两张表，自己连接自己。" class="headerlink" title="自连接：一张表看成两张表，自己连接自己。"></a>自连接：一张表看成两张表，自己连接自己。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个员工上级领导，要求显示员工名和对应领导名</span><br><span class="line">mysql&gt; select a.ename,b.ename from emp a inner join emp b on a.mgr = b.empno;</span><br><span class="line">+--------+-------+</span><br><span class="line">| ename  | ename |</span><br><span class="line">+--------+-------+</span><br><span class="line">| SMITH  | FORD  |</span><br><span class="line">| ALLEN  | BLAKE |</span><br><span class="line">| WARD   | BLAKE |</span><br><span class="line">| JONES  | KING  |</span><br><span class="line">| MARTIN | BLAKE |</span><br><span class="line">| BLAKE  | KING  |</span><br><span class="line">| CLARK  | KING  |</span><br><span class="line">| SCOTT  | JONES |</span><br><span class="line">| TURNER | BLAKE |</span><br><span class="line">| ADAMS  | SCOTT |</span><br><span class="line">| JAMES  | BLAKE |</span><br><span class="line">| FORD   | JONES |</span><br><span class="line">| MILLER | CLARK |</span><br><span class="line">+--------+-------+</span><br><span class="line"># a是员工表，b是领导表，实际上是一张表，因为员工和领导都在一张表里</span><br><span class="line"># 因此join的条件是 a.mgr领导编号 = b.empno 员工编号</span><br></pre></td></tr></table></figure>

<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>A B表内连接时：</p>
<ul>
<li>内连接：凡是A和B匹配的记录就能被查询出来，AB没有主副之分，两表平等</li>
<li>外连接：有主副之分，主要查询主表，如果副表中的数据没有和主表匹配上，副表自动模拟出NULL与之匹配。<ul>
<li>左外连接：左边表是主表</li>
<li>右外连接：右表是主表</li>
<li>左连接会有右连接的写法，右连接会有左连接的写法</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个员工的上级领导，没有上级领导时该字段为null。</span><br><span class="line">mysql&gt; select a.ename &#x27;员工&#x27;, b.ename &#x27;领导&#x27; from emp a left join emp b on a.mgr = b.empno;  </span><br><span class="line">+--------+-------+</span><br><span class="line">| 员工   | 领导  |</span><br><span class="line">+--------+-------+</span><br><span class="line">| SMITH  | FORD  |</span><br><span class="line">| ALLEN  | BLAKE |</span><br><span class="line">| WARD   | BLAKE |</span><br><span class="line">| JONES  | KING  |</span><br><span class="line">| MARTIN | BLAKE |</span><br><span class="line">| BLAKE  | KING  |</span><br><span class="line">| CLARK  | KING  |</span><br><span class="line">| SCOTT  | JONES |</span><br><span class="line">| KING   | NULL  |  # king是老板，所以没有上级领导</span><br><span class="line">| TURNER | BLAKE |</span><br><span class="line">| ADAMS  | SCOTT |</span><br><span class="line">| JAMES  | BLAKE |</span><br><span class="line">| FORD   | JONES |</span><br><span class="line">| MILLER | CLARK |</span><br><span class="line">+--------+-------+</span><br><span class="line">mysql&gt; select a.ename &#x27;员工&#x27;, b.ename &#x27;领导&#x27; from emp a left outer join emp b on a.mgr = b.empno;  # outer可以省略</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 找出没有员工的部门</span><br><span class="line"># 左连接</span><br><span class="line">mysql&gt; select d.deptno, d.dname from dept d left outer join emp e on d.deptno = e.deptno where e.empno is null;</span><br><span class="line">+--------+------------+</span><br><span class="line">| deptno | dname      |</span><br><span class="line">+--------+------------+</span><br><span class="line">|     40 | OPERATIONS |</span><br><span class="line">+--------+------------+</span><br><span class="line"># 右连接</span><br><span class="line">mysql&gt; select d.deptno, d.dname from emp e right outer join dept d on d.deptno = e.deptno where e.empno is null;</span><br><span class="line">+--------+------------+</span><br><span class="line">| deptno | dname      |</span><br><span class="line">+--------+------------+</span><br><span class="line">|     40 | OPERATIONS |</span><br><span class="line">+--------+------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="三张表连接"><a href="#三张表连接" class="headerlink" title="三张表连接"></a>三张表连接</h3><p><code>select ...from A join B on ... join C on ...</code> ，A先跟B再跟C连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># 找出每个员工的部门名称 以及 工资等级</span><br><span class="line">mysql&gt; select e.ename, d.dname, s.grade </span><br><span class="line">from emp e </span><br><span class="line">join dept d on e.deptno = d.deptno </span><br><span class="line">join salgrade s on e.sal between s.losal and s.hisal;</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">| ename  | dname      | grade |</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">| SMITH  | RESEARCH   |     1 |</span><br><span class="line">| ALLEN  | SALES      |     3 |</span><br><span class="line">| WARD   | SALES      |     2 |</span><br><span class="line">| JONES  | RESEARCH   |     4 |</span><br><span class="line">| MARTIN | SALES      |     2 |</span><br><span class="line">| BLAKE  | SALES      |     4 |</span><br><span class="line">| CLARK  | ACCOUNTING |     4 |</span><br><span class="line">| SCOTT  | RESEARCH   |     4 |</span><br><span class="line">| KING   | ACCOUNTING |     5 |</span><br><span class="line">| TURNER | SALES      |     3 |</span><br><span class="line">| ADAMS  | RESEARCH   |     1 |</span><br><span class="line">| JAMES  | SALES      |     1 |</span><br><span class="line">| FORD   | RESEARCH   |     4 |</span><br><span class="line">| MILLER | ACCOUNTING |     2 |</span><br><span class="line">+--------+------------+-------+</span><br><span class="line"># 找出每个员工的部门名称、 工资等级、 以及上级领导</span><br><span class="line">mysql&gt; select e.ename, d.dname, s.grade, ee.ename &#x27;领导&#x27;</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join dept d on e.deptno = d.deptno</span><br><span class="line">    -&gt; join salgrade s on e.sal between s.losal and s.hisal</span><br><span class="line">    -&gt; left join emp ee on e.mgr = ee.empno;</span><br><span class="line">+--------+------------+-------+-------+</span><br><span class="line">| ename  | dname      | grade | 领导  |</span><br><span class="line">+--------+------------+-------+-------+</span><br><span class="line">| SMITH  | RESEARCH   |     1 | FORD  |</span><br><span class="line">| ALLEN  | SALES      |     3 | BLAKE |</span><br><span class="line">| WARD   | SALES      |     2 | BLAKE |</span><br><span class="line">| JONES  | RESEARCH   |     4 | KING  |</span><br><span class="line">| MARTIN | SALES      |     2 | BLAKE |</span><br><span class="line">| BLAKE  | SALES      |     4 | KING  |</span><br><span class="line">| CLARK  | ACCOUNTING |     4 | KING  |</span><br><span class="line">| SCOTT  | RESEARCH   |     4 | JONES |</span><br><span class="line">| KING   | ACCOUNTING |     5 | NULL  |</span><br><span class="line">| TURNER | SALES      |     3 | BLAKE |</span><br><span class="line">| ADAMS  | RESEARCH   |     1 | SCOTT |</span><br><span class="line">| JAMES  | SALES      |     1 | BLAKE |</span><br><span class="line">| FORD   | RESEARCH   |     4 | JONES |</span><br><span class="line">| MILLER | ACCOUNTING |     2 | CLARK |</span><br><span class="line">+--------+------------+-------+-------+</span><br></pre></td></tr></table></figure>

<h3 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h3><p>实际上是外连接时，左右表都实行左右外联，使得如果 “left_table” 表中的行在 “right_table” 中没有匹配或者 “right_table” 表中的行在</p>
<p>“left_table” 表中没有匹配，也会列出这些行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># key word：</span><br><span class="line">full join</span><br></pre></td></tr></table></figure>





<p>insert into student_table values(‘1009’ , ‘李四’, ‘2000-01-01’, ‘男’);<br>insert into student_table values(‘1010’ , ‘李四’, ‘2001-01-01’, ‘男’);<br>insert into student_table values(‘1006’ , ‘王五’, ‘2000-08-06’ , ‘女’);<br>insert into student_table values(‘1008’ , ‘张三’, ‘2002-12-01’, ‘女’);<br>insert into student_table values(‘1012’ , ‘张三’, ‘2001-12-01’, ‘女’);<br>insert into student_table values(‘1011’ , ‘李四’, ‘2002-08-06’ , ‘女’);<br>insert into student_table values(‘1013’ , ‘赵六’ ,’2000-09-06’ , ‘男’);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select * from</span><br><span class="line"></span><br><span class="line">select t1.*,t2.*</span><br><span class="line">from (</span><br><span class="line">select * from student_table where sex = &#x27;男&#x27; ) t1 </span><br><span class="line">left join </span><br><span class="line">(select * from student_table where sex = &#x27;女&#x27;) t2 </span><br><span class="line">on t1.name = t2.name </span><br><span class="line"></span><br><span class="line">union all</span><br><span class="line"></span><br><span class="line">select t1.*,t2.*</span><br><span class="line">from (</span><br><span class="line">select * from student_table where sex = &#x27;男&#x27; ) t1 </span><br><span class="line">right join </span><br><span class="line">(select * from student_table where sex = &#x27;女&#x27;) t2 </span><br><span class="line">on t1.name = t2.name;</span><br></pre></td></tr></table></figure>



<p>select t1.<em>,t2.</em><br>from (<br>select * from student_table where sex &#x3D; ‘男’ ) t1<br>left join<br>(select * from student_table where sex &#x3D; ‘女’)t2<br>on t1.name &#x3D; t2.name<br>union<br>select t1.<em>,t2.</em><br>from (<br>select * from student_table where sex &#x3D; ‘男’ ) t1<br>right join<br>(select * from student_table where sex &#x3D; ‘女’)t2<br>on t1.name &#x3D; t2.name;</p>
<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>select中嵌套select，被嵌套的select语句称为子查询。理解为：select后就是一张临时的新表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">	..(select)..</span><br><span class="line">from</span><br><span class="line">	..(select)..  # 查询结果将会当成临时表</span><br><span class="line">where</span><br><span class="line">	..(select)..</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># where：找出高于平均薪资的员工信息</span><br><span class="line">mysql&gt; select * from emp where sal &gt; (select avg(sal) from emp);</span><br><span class="line"># from：找出每个部门平均薪水的薪资等级</span><br><span class="line">select a.avgsal, s.grade </span><br><span class="line">from (select avg(sal) avgsal from emp group by deptno) a </span><br><span class="line">join salgrade s </span><br><span class="line">where a.avgsal between s.losal and s.hisal ;</span><br><span class="line">+-------------+-------+</span><br><span class="line">| avgsal      | grade |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| 2175.000000 |     4 |</span><br><span class="line">| 1566.666667 |     3 |</span><br><span class="line">| 2916.666667 |     4 |</span><br><span class="line">+-------------+-------+</span><br><span class="line"></span><br><span class="line"># 找出每个部门平均的薪资等级</span><br><span class="line"># 正确结果，但错误写法，因为没必要from后当成临时表</span><br><span class="line">mysql&gt; select avg(tmp.grade) </span><br><span class="line">	from </span><br><span class="line">(select e.ename, s.grade, e.deptno from emp e join salgrade s on e.sal between s.losal and s.hisal) tmp </span><br><span class="line">	group by tmp.deptno;</span><br><span class="line">+----------------+</span><br><span class="line">| avg(tmp.grade) |</span><br><span class="line">+----------------+</span><br><span class="line">|         2.8000 |</span><br><span class="line">|         2.5000 |</span><br><span class="line">|         3.6667 |</span><br><span class="line">+----------------+</span><br><span class="line"># select时，s.grade，e.deptno信息已经存在，没必要当成临时表tmp再嵌套</span><br><span class="line">select avg(s.grade), e.deptno from emp e join salgrade s on e.sal between s.losal and s.hisal group by e.deptno;</span><br></pre></td></tr></table></figure>



<h2 id="union"><a href="#union" class="headerlink" title="union"></a>union</h2><p>可以将查询结果集相加，默认去重</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 找出工作岗位是SALESMAN和MANAGER的员工</span><br><span class="line">select * from emp where job = &#x27;MANAGER&#x27; or job = &#x27;SALESMAN&#x27;;</span><br><span class="line">select * from emp where job in (&#x27;MANAGER&#x27;, &#x27;SALESMAN&#x27;);</span><br><span class="line"></span><br><span class="line">select * from emp where job = &#x27;MANAGER&#x27; </span><br><span class="line">union</span><br><span class="line">select * from emp where job = &#x27;SALESMAN&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select ...</span><br><span class="line">union all # 不去重</span><br><span class="line">select ...</span><br></pre></td></tr></table></figure>



<p>union可以解决 or 和 in 无法解决的：两张不相干的表中数据拼接在一起，虽然可能意义不大。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 没有意义，但能拼接，列数不同不能拼接</span><br><span class="line">select ename from emp</span><br><span class="line">union</span><br><span class="line">select dname from dept;</span><br></pre></td></tr></table></figure>



<p>union中只能在最后有一个order by排序，除非对其中一个select加括号，将order by放入其中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 不合法</span><br><span class="line">select ... order by ...</span><br><span class="line">union</span><br><span class="line">select ... order by ...</span><br><span class="line"># 合法，先对第一个select的排序，然后对union后的整体排序</span><br><span class="line">(select ... order by ...)</span><br><span class="line">union</span><br><span class="line">select ... order by ...</span><br><span class="line"># 合法，先括号子查询，后union</span><br><span class="line">(select ... order by ...)</span><br><span class="line">union</span><br><span class="line">(select ... order by ...)</span><br><span class="line">order by ...</span><br></pre></td></tr></table></figure>



<h2 id="limit（特有）"><a href="#limit（特有）" class="headerlink" title="limit（特有）"></a>limit（特有）</h2><p>作用：取部分数据。</p>
<p>mysql特有，也是sql语句最后执行的环节，oracle有相同的机制<code>rownum</code>，分页查询用。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit startIndex, length</span><br><span class="line"># startIndex表示起始位置</span><br><span class="line"># length表示取几个</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 找出工资前五名的员工</span><br><span class="line">mysql&gt; select ename, sal from emp order by sal desc limit 0, 5;</span><br><span class="line">+-------+---------+</span><br><span class="line">| ename | sal     |</span><br><span class="line">+-------+---------+</span><br><span class="line">| KING  | 5000.00 |</span><br><span class="line">| SCOTT | 3000.00 |</span><br><span class="line">| FORD  | 3000.00 |</span><br><span class="line">| JONES | 2975.00 |</span><br><span class="line">| BLAKE | 2850.00 |</span><br><span class="line">+-------+---------+</span><br><span class="line"># 默认从0开始</span><br><span class="line">mysql&gt; select ename, sal from emp order by sal desc limit 5;</span><br></pre></td></tr></table></figure>

<p>每页显示pageSize条记录：<code>( pageNo - 1) * pageSize, pageSize</code></p>
<h2 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h2><p>1、LOCATE(substr , str )：返回子串 substr 在字符串 str 中第一次出现的位置，如果字符substr在字符串str中不存在，则返回0；</p>
<p>2、POSITION(substr IN str )：返回子串 substr 在字符串 str 中第一次出现的位置，如果字符substr在字符串str中不存在，与LOCATE函数作用相同；</p>
<p>3、LEFT(str, length)：从左边开始截取str，length是截取的长度；</p>
<p>4、RIGHT(str, length)：从右边开始截取str，length是截取的长度；</p>
<p>5、SUBSTRING_INDEX(str ,substr ,n)：</p>
<ul>
<li><p>当n&gt;0，返回字符substr在str中从左到右第n次出现位置之前的字符串;</p>
</li>
<li><p>当n&lt;0，返回字符substr在str中从右到左第n次出现位置之后的字符串;</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/a5475ed3b5ab4de58e2ea426b4b2db76?tpId=240&tqId=2202382&ru=/practice/255aa1863fe14aa88694c09ebbc1dbca&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj">修复串列了的记录_牛客题霸_牛客网 (nowcoder.com)</a></p>
</li>
</ul>
<p>6、SUBSTRING(str ,n ,m)：返回字符串str从第n个字符截取到第m个字符；</p>
<p>7、REPLACE(str, n, m)：将字符串str中的n字符替换成m字符；</p>
<p>8、LENGTH(str)：计算字符串str的长度。</p>
<p>9、CONCAT(字段A, 分隔符, 字段B)</p>
<p>10、GROUP_CONCAT(字段名 SEPARATOR ‘;’) 和GROUP_BY一起使用，将同一组内同一字段的所有数据连接，默认以逗号作为分隔符，若要指定分隔符 加上<code>SEPARATOR &#39;;&#39;</code>即可，注意没有逗号。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/46cb7a33f7204f3ba7f6536d2fc04286?tpId=240&tqId=2183007&ru=/practice/f6b4770f453d4163acc419e3d19e6746&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/oj">	未完成试卷数大于1的有效用户_牛客题霸_牛客网 (nowcoder.com)</a></li>
</ul>
<h1 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">    字段名1 数据类型,</span><br><span class="line">    字段名2 数据类型,</span><br><span class="line">    字段名3 数据类型,</span><br><span class="line">    ....);</span><br></pre></td></tr></table></figure>

<p>关于MySQL当中字段的数据类型？</p>
<ul>
<li>int		整数型</li>
<li>bigint	长整型</li>
<li>float		浮点型</li>
<li>char		定长字符串<strong>（字段长度定长时，如性别、日期1999-01-01等）</strong></li>
<li>varchar	可变长字符串<strong>（字段长度不确定时，如姓名等）</strong></li>
<li>date		日期类型 </li>
<li>BLOB		二进制大对象（存储图片、视频等流媒体信息） </li>
<li>CLOB		字符大对象（存储较大文本，比如，可以存储4G的字符串。）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建学生表：学号、姓名、性别、班级编号、生日</span><br><span class="line">create table t_student(</span><br><span class="line">    no bigint,</span><br><span class="line">    name varchar(255),</span><br><span class="line">    sex char(1) default,</span><br><span class="line">    classno varchar(255),</span><br><span class="line">    birth char(10)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>建表后单独加外键约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 </span><br><span class="line">ADD CONSTRAINT 外键名 </span><br><span class="line">FOREIGN KEY (本表外键列名) </span><br><span class="line">REFERENCES 主表名(主表主键列名)</span><br></pre></td></tr></table></figure>





<h1 id="插入Insert"><a href="#插入Insert" class="headerlink" title="插入Insert"></a>插入Insert</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 插入时，指定字段</span><br><span class="line">insert into table1 (file1, file2, ...) values (value1, value2, ...);</span><br><span class="line"># 插入时，指定字段，插入多行</span><br><span class="line">insert into table1 (file1, file2, ...) values (value1, value2, ...),(value1, value2, ...),(value1, value2, ...);</span><br><span class="line"># 省略字段</span><br><span class="line">insert into table1 values (value1, value2, ...);</span><br></pre></td></tr></table></figure>

<p>指定字段插入时，value 和 file的类型要一一对应，可以颠倒字段顺序；如果此时某些file没填入，value则为字段的默认值，如果未指定默认值则为<code>NULL</code>。</p>
<p>当字段省略时，所有的value都要填入，否则报错。主键可以设置为null，因为会自增。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace into</span><br></pre></td></tr></table></figure>

<p>语法和insert into一致，作用是试图插入，若其中某个value的对应字段是unique的话且value重复的话，则找到这个value对应的记录，并update；否则执行插入操作。</p>
<h1 id="表的复制"><a href="#表的复制" class="headerlink" title="表的复制"></a>表的复制</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 根据select的查询结果当作表，创建出table1</span><br><span class="line">create table table1 as select * from t_student;</span><br></pre></td></tr></table></figure>

<h1 id="查询结果插入到另一个表中"><a href="#查询结果插入到另一个表中" class="headerlink" title="查询结果插入到另一个表中"></a>查询结果插入到另一个表中</h1><p>字段数要相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_tmp select * from t_student;</span><br></pre></td></tr></table></figure>



<h1 id="修改数据update"><a href="#修改数据update" class="headerlink" title="修改数据update"></a>修改数据update</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_table set 字段名1=值1, 字段名2=值2, ... where 条件;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 将部门10的loc修改为shanghai，将部门名称改为renshibu</span><br><span class="line">update tmp_dept set loc = &#x27;shanghai&#x27;, dname = &#x27;renshibu&#x27; where deptno = 10;</span><br><span class="line"># 没有where条件时更新所有记录</span><br><span class="line">update tmp_dept set loc = &#x27;x&#x27;, dname = &#x27;y&#x27;;</span><br></pre></td></tr></table></figure>



<h1 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from t_table where 条件;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 条件删除</span><br><span class="line">delete from tmp_dept where deptno = 10;</span><br><span class="line"># 删除全部表记录</span><br><span class="line">delete from tmp_dept;</span><br></pre></td></tr></table></figure>

<p>如果表数据庞大，使用delete删除要很久，因为它没有释放数据，可以回滚记录。</p>
<p>因此使用<code>truncate</code>语句删除大表，表被截断，不可回滚，永久丢失</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table tmp_dept; </span><br></pre></td></tr></table></figure>

<p>1.DELETE 可以加where 条件，truncate 不能加</p>
<p>2.truncate删除，效率高一些</p>
<p>3.假如要删除的表中有自增长列，如果用delete 删除后，再插入数据，自增长列的值从断点开始，而truncate删除后，再插入数据，自增长列的值从1开始</p>
<p>4.truncate删除后没有返回值，delete 删除有返回值</p>
<p>5.truncate 删除后不能回滚，delete 删除可以回滚</p>
<p>1.DROP TABLE　清除数据并且销毁表，是一种数据库定义语言(DDL Data Definition Language), 执行后不能撤销，被删除表格的关系，索引，权限等等都会被永久删除。</p>
<p>2.TRUNCATE TABLE　只清除数据，保留表结构，列，权限，索引，视图，关系等等，相当于清零数据，是一种数据库定义语言(DDL Data Definition Language)，执行后不能撤销。</p>
<p>3.DELETE TABLE　删除（符合某些条件的）数据，是一种数据操纵语言(DML Data Manipulation Language)，执行后可以撤销。</p>
<h1 id="删表"><a href="#删表" class="headerlink" title="删表"></a>删表</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop table t_student; # 通用写法</span><br><span class="line">drop table if exists t_student; # mysql写法</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h1><p>1.添加列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add column 列名 类型 【first|after 字段名】;</span><br></pre></td></tr></table></figure>

<p>2.修改列的类型或约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify column 列名 新类型 【新约束】;</span><br></pre></td></tr></table></figure>

<p>3.修改列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 change column 旧列名 新列名 类型;</span><br></pre></td></tr></table></figure>

<p>4 .删除列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop column 列名;</span><br></pre></td></tr></table></figure>

<p>5.修改表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 rename 【to】 新表名;</span><br></pre></td></tr></table></figure>

<p>6.将某一列放到第一列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify column 列名 类型 first;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>题目：<a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/d08209df6f464cebafda5dfd5de03fce?tpId=240&tqId=2223567&ru=/practice/a61ee5519d14444aa99e530309a8e043&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/company">https://www.nowcoder.com/practice/d08209df6f464cebafda5dfd5de03fce?tpId=240&amp;tqId=2223567&amp;ru=%2Fpractice%2Fa61ee5519d14444aa99e530309a8e043&amp;qru=%2Fta%2Fsql-advanced%2Fquestion-ranking&amp;sourceUrl=%2Fexam%2Fcompany</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE user_info ADD COLUMN school VARCHAR(15) AFTER level;</span><br><span class="line">ALTER TABLE user_info CHANGE COLUMN job profession VARCHAR(10);</span><br><span class="line">ALTER TABLE user_info MODIFY COLUMN achievement INT(11) default 0;  # 新类型必须要</span><br></pre></td></tr></table></figure>



<h1 id="约束constraint"><a href="#约束constraint" class="headerlink" title="约束constraint"></a>约束constraint</h1><p>约束测试代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table t_user;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int primary key,</span><br><span class="line">    email varchar(255),</span><br><span class="line">    username varchar(255) </span><br><span class="line">);</span><br><span class="line">insert into t_user(id, username, email) values(1,&#x27;cj1&#x27;,&#x27;123@qq.com&#x27;);</span><br><span class="line">insert into t_user(id, username, email) values(2,&#x27;cj2&#x27;,&#x27;234@qq.com&#x27;);</span><br><span class="line">insert into t_user(id, username, email) values(3,&#x27;cj3&#x27;,&#x27;345@qq.com&#x27;);</span><br></pre></td></tr></table></figure>

<p>保证表内数据的合法性、有效性、完整性，例如某些</p>
<ul>
<li>非空约束（not null）：不能为空</li>
<li>唯一约束（unique）：不能重复</li>
<li>主键约束（primary key）：既不能为null，也不能重复</li>
<li>外键约束（foreign key, FK）：</li>
<li>检查约束（check）：mysql无，oracle有。</li>
</ul>
<h2 id="非空约束-not-nll"><a href="#非空约束-not-nll" class="headerlink" title="非空约束 not nll"></a>非空约束 not nll</h2><p>只能在字段后面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(</span><br><span class="line">	id int,</span><br><span class="line">    username varchar(255) not null,  # 非空</span><br><span class="line">    password varchar(255) </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="唯一性约束-unique"><a href="#唯一性约束-unique" class="headerlink" title="唯一性约束 unique"></a>唯一性约束 unique</h2><p>可以为null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(</span><br><span class="line">	id int,</span><br><span class="line">    usercode varchar(255) unique# 不能重复 （列级约束）</span><br><span class="line">    username varchar(255) unique# 不能重复 （列级约束）</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>联合unique，not null 没有此写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(</span><br><span class="line">	id int,</span><br><span class="line">    usercode varchar(255) </span><br><span class="line">    username varchar(255) </span><br><span class="line">	unique(usercode, username) # 联合unique，两个字段的值不能同时相同 （表级约束）</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="主键约束-primary-key"><a href="#主键约束-primary-key" class="headerlink" title="主键约束 primary key"></a>主键约束 primary key</h2><h3 id="相关术语："><a href="#相关术语：" class="headerlink" title="相关术语："></a>相关术语：</h3><p>主键约束（primary key本身）、主键字段（有primary key的字段）、主键值（主键字段的值）</p>
<ul>
<li>只要主键不一样，就认为是不一样的记录，是表里的唯一表示。</li>
<li>表的设计三范式中，第一范式就是任何一张表都应该有主键，任何一张表只能有一个主键。</li>
</ul>
<h3 id="主键分类："><a href="#主键分类：" class="headerlink" title="主键分类："></a>主键分类：</h3><ul>
<li>根据主键字段数量来划分<ul>
<li>单一主键</li>
<li>复合主键（不建议使用，违背三范式）：多个字段联合起来添加一个主键约束</li>
</ul>
</li>
<li>根据主键性质来划分<ul>
<li>自然主键</li>
<li>业务主键（不建议使用）：身份证、银行卡号</li>
</ul>
</li>
</ul>
<h3 id="主键自增"><a href="#主键自增" class="headerlink" title="主键自增"></a>主键自增</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop table t_user;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int primary key auto_increment, # 自动维护一个以1开始自增的</span><br><span class="line">    username varchar(255)</span><br><span class="line">);</span><br><span class="line">insert into t_user(username) values(&#x27;a&#x27;);</span><br><span class="line">insert into t_user(username) values(&#x27;b&#x27;);</span><br><span class="line">select * from t_user;</span><br><span class="line">+----+----------+</span><br><span class="line">| id | username |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | a        |</span><br><span class="line">|  2 | b        |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure>

<p>oracle提供了一种自增机制：sequence序列</p>
<h2 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h2><h3 id="相关术语"><a href="#相关术语" class="headerlink" title="相关术语"></a>相关术语</h3><p>主键约束（primary key本身）、主键字段（有primary key的字段）、主键值（主键字段的值）</p>
<h3 id="业务背景："><a href="#业务背景：" class="headerlink" title="业务背景："></a>业务背景：</h3><p>设计数据库表，维护学生和班级的信息，区分出班级表和学生表</p>
<pre><code>                t_class 班级表
--------------------------------------------------------
cno(pk)		cname
--------------------------------------------------------
101			北京大兴区经济技术开发区亦庄二中高三1班
102			北京大兴区经济技术开发区亦庄二中高三2班
--------------------------------------------------------

                t_student 学生表
--------------------------------------------------------
sno(pk)		sname		classno(该字段添加外键约束fk)
--------------------------------------------------------
1			zs1			101
2			zs2			101
3			zs3			102
4			zs4			102
5			zs5			102
--------------------------------------------------------
</code></pre>
<p>加上了外键约束后，classno的值只能来自于t_class的cno。</p>
<ul>
<li>t_student中的clasno字段引用 t_class表中的cno字段。此时t_student是子表，t_class为父表。<ul>
<li>删除数据的时候，先删除子表，再删除父表。</li>
<li>添加数据的时候，先添加父表，在添加子表。</li>
<li>创建表的时候，先创建父表，再创建子表。</li>
<li>删除表的时候，先删除子表，在删除父表。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists t_student;</span><br><span class="line">drop table if exists t_class;</span><br><span class="line">#</span><br><span class="line">create table t_class(</span><br><span class="line">	cno int primary key,</span><br><span class="line">    cname varchar(255),</span><br><span class="line">);</span><br><span class="line">#</span><br><span class="line">create table t_student(</span><br><span class="line">	sno int primary key,</span><br><span class="line">    sname varchar(255),</span><br><span class="line">    classno int,</span><br><span class="line">    foreign key(classno) references t_class(cno)</span><br><span class="line">);</span><br><span class="line">insert into t_class values(101,&#x27;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;);</span><br><span class="line">insert into t_class values(102,&#x27;yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy&#x27;);</span><br><span class="line"></span><br><span class="line">insert into t_student values(1,&#x27;zs1&#x27;,101);</span><br><span class="line">insert into t_student values(2,&#x27;zs2&#x27;,101);</span><br><span class="line">insert into t_student values(3,&#x27;zs3&#x27;,102);</span><br><span class="line">insert into t_student values(4,&#x27;zs4&#x27;,102);</span><br><span class="line">insert into t_student values(5,&#x27;zs5&#x27;,102);</span><br><span class="line">insert into t_student values(6,&#x27;zs6&#x27;,102);</span><br><span class="line">select * from t_class;</span><br><span class="line">select * from t_student;</span><br><span class="line"></span><br><span class="line">insert into t_student values(7,&#x27;zs6&#x27;,103); # 103在t_class.cno不存在</span><br><span class="line">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`dljd`.`t_student`, CONSTRAINT `t_student_ibfk_1` FOREIGN KEY (`classno`) REFERENCES `t_class` (`cno`))</span><br><span class="line">insert into t_student values(8,&#x27;zs6&#x27;); # 插入成功，外键可以为null</span><br></pre></td></tr></table></figure>

<ul>
<li>外键可以为null</li>
<li>被引用的字段不一定是主键，但至少具有unique约束，也就是能找到一个唯一的记录，如t_class里cno可以不是主键，但不能有两个101的记录。</li>
</ul>
<h1 id="存储引擎（了解即可）"><a href="#存储引擎（了解即可）" class="headerlink" title="存储引擎（了解即可）"></a>存储引擎（了解即可）</h1><p>存储引擎只在mysql存在。oracle也有对应机制，只称为：存储方式。</p>
<p>每种存储引擎都只有自己有缺点，对应一种存储方式。</p>
<p>完整的建表语句，还要指定存储引擎、字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_x` (</span><br><span class="line">    `id` int(11) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"># 飘号 ``， mysql可用但不通用，最好不用</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看mysql支持的存储引擎</span><br><span class="line">show engines \G </span><br></pre></td></tr></table></figure>

<p>常见的存储引擎：</p>
<pre><code>Engine: MyISAM
Support: YES
Comment: MyISAM storage engine
Transactions: NO
XA: NO
Savepoints: NO

MyISAM这种存储引擎不支持事务。
MyISAM是mysql最常用的存储引擎，但是这种引擎不是默认的。
MyISAM采用三个文件组织一张表：
    xxx.frm（存储格式的文件）
    xxx.MYD（存储表中数据的文件）
    xxx.MYI（存储表中索引的文件）
优点：可被压缩，节省存储空间。并且可以转换为只读表，提高检索效率。
缺点：不支持事务。

-----------------------------------------------------------------------------

Engine: InnoDB
Support: DEFAULT
Comment: Supports transactions, row-level locking, and foreign keys
Transactions: YES
XA: YES
Savepoints: YES

优点：支持事务、行级锁、外键等。这种存储引擎数据的安全得到保障。

表的结构存储在xxx.frm文件中
数据存储在tablespace这样的表空间中（逻辑概念），无法被压缩，无法转换成只读。
这种InnoDB存储引擎在MySQL数据库崩溃之后提供自动恢复机制。
InnoDB支持级联删除和级联更新。
    
-------------------------------------------------------------------------------------

Engine: MEMORY
Support: YES
Comment: Hash based, stored in memory, useful for temporary tables
Transactions: NO
XA: NO
Savepoints: NO

缺点：不支持事务。数据容易丢失。因为所有数据和索引都是存储在内存当中的。
优点：查询速度最快。
以前叫做HEPA引擎。
</code></pre>
<h1 id="事务（Transaction）"><a href="#事务（Transaction）" class="headerlink" title="事务（Transaction）"></a>事务（Transaction）</h1><p>一个事务是完整的业务逻辑单元，不可再分，例如银行账户A向账户B转账，需要执行两条upda语句，不允许一条成功，一条失败。</p>
<ul>
<li><p>如何保证这两条DML语句全部成功：事务机制。和事务相关的语句只有DML语句（insert delete update），因为这三个语句都与数据相关。</p>
</li>
<li><p>当只有一条DML语句时，不需要事务机制。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insert -&gt; update -&gt;delete</span><br><span class="line">开启事务机制（开始）</span><br><span class="line">执行insert语句-&gt; insert执行成功后，记录到数据库的历史操作，不修改硬盘数据。</span><br><span class="line">执行update语句-&gt; update执行成功后，记录到数据库的历史操作，不修改硬盘数据。</span><br><span class="line">执行delete语句-&gt; delete执行成功后，记录到数据库的历史操作，不修改硬盘数据。</span><br><span class="line">提交事务或回滚事务（结束）# SQL语句分类中的 TCL（事务控制语言）：commit提交事务，rollback回滚事务</span><br></pre></td></tr></table></figure>

<h2 id="事务四大特性ACID"><a href="#事务四大特性ACID" class="headerlink" title="事务四大特性ACID"></a>事务四大特性ACID</h2><ul>
<li>A：原子性，事务是最小的工作单元，不可再分</li>
<li>C：一致性，事务必须保证多条DML语句同时成功或同时失败</li>
<li>I：隔离性，事务A与B之间具有隔离<ul>
<li>第一级别：读未提交（read uncommitted)：对方事务还没提交，当前事务可用读取到未提交的数据，<ul>
<li>问题：存在脏读（dirty read）现象，表示读到了未在硬盘的数据。</li>
</ul>
</li>
<li>第二级别：读提交（read committed)：对方事务提交后的数据，我方可用读到。解决脏读问题。<ul>
<li>问题：不可重复读取，如果有其他事务一直在修改，每次数据读出来不一样。</li>
</ul>
</li>
<li>第三级别：可重复读（repeatable read）：读到的永远是开启事务前的数据，即便其他用户已经修改或删除了数据，读取的仍是备份数据。解决了不可重复读问题<ul>
<li>问题：读取到的是过期数据。</li>
</ul>
</li>
<li>第四级别：序列化读&#x2F;串行化读：两个事务不能并发。解决以上问题。<ul>
<li>问题：效率低，事务排队。</li>
</ul>
</li>
</ul>
</li>
<li>D：持久性，最终处理的数据必须持久化到硬盘文件中，事务才算成功结束</li>
</ul>
<p>oracle默认的隔离级别是第二级别起步，mysql则是第三级别。</p>
<h2 id="演示事务"><a href="#演示事务" class="headerlink" title="演示事务"></a>演示事务</h2><p>准备表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists t_user;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">    username varchar(255)</span><br><span class="line">);</span><br><span class="line">insert into t_user(username) values(&#x27;cj1&#x27;);</span><br></pre></td></tr></table></figure>

<p>mysql事务自动提交，即只要执行一次DML提交一次。</p>
<p>使用<code>start transaction</code>关闭自动提交机制，开启事务机制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 事务开始</span><br><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"># 连续的两条插入</span><br><span class="line">mysql&gt; insert into t_user(username) values(&#x27;cj2&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; insert into t_user(username) values(&#x27;cj3&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; select * from t_user;</span><br><span class="line">+----+----------+</span><br><span class="line">| id | username |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | cj1      |</span><br><span class="line">|  2 | cj2      |</span><br><span class="line">|  3 | cj3      |</span><br><span class="line">+----+----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"># rollback回滚到事务开始前</span><br><span class="line">mysql&gt; rollback;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; select * from t_user;</span><br><span class="line">+----+----------+</span><br><span class="line">| id | username |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | cj1      |</span><br><span class="line">+----+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"># 再插入，发现主键不从2开始了</span><br><span class="line">mysql&gt; insert into t_user(username) values(&#x27;cj4&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; select * from t_user;</span><br><span class="line">+----+----------+</span><br><span class="line">| id | username |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | cj1      |</span><br><span class="line">|  4 | cj4      |</span><br><span class="line">+----+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>



<p>设置全局隔离权限</p>
<p>测试权限时，可以开启cmd连接数据库，一个修改数据，另一个查看数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 演示第1级别：读未提交</span><br><span class="line">set global transaction isolation level read uncommitted;</span><br><span class="line"># 演示第2级别：读已提交</span><br><span class="line">set global transaction isolation level read committed;</span><br><span class="line"># 演示第3级别：可重复读</span><br><span class="line">set global transaction isolation level repeatable read;</span><br><span class="line"># 序列化读</span><br><span class="line">set global transaction isolation level  serializable;</span><br></pre></td></tr></table></figure>

<p>查看全局隔离权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># mysql&gt; select @@global.tx_isolation; # 旧版的方法</span><br><span class="line">mysql&gt; select @@global.transaction_isolation;</span><br><span class="line">+--------------------------------+</span><br><span class="line">| @@global.transaction_isolation |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| READ-COMMITTED                 |</span><br><span class="line">+--------------------------------+</span><br></pre></td></tr></table></figure>



<h1 id="索引（底层是红黑树）"><a href="#索引（底层是红黑树）" class="headerlink" title="索引（底层是红黑树）"></a>索引（底层是红黑树）</h1><p>查询一张表的时候有两种检索方式：</p>
<ul>
<li>全表扫描</li>
<li>根据索引检索（效率很高）</li>
</ul>
<p>索引虽然可以提高检索效率，但是不能随意的添加索引，因为索引也是数据库当中的对象，需要数据库不断的维护。是有维护成本的</p>
<p>什么情况索引更好?</p>
<ul>
<li>数据量庞大</li>
<li>该字段很少DML操作，为数据一旦修改，索引需要重新排序，进行维护。</li>
<li>该字段经常出现在where子句中。</li>
</ul>
<p>注意：</p>
<ul>
<li>主键和具有unique的字段自动有索引，因此根据主键索引效率更高。</li>
<li>当模糊查询时，第一个通配符是%时，索引会失效。</li>
</ul>
<h1 id="创建索引和删除索引"><a href="#创建索引和删除索引" class="headerlink" title="创建索引和删除索引"></a>创建索引和删除索引</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 创建索引对象</span><br><span class="line">create index index_name on table1(field1);</span><br><span class="line"># 删除索引对象</span><br><span class="line">drop index index_name on table1; # mysql</span><br><span class="line">drop index index_name; #oracle</span><br></pre></td></tr></table></figure>

<h3 id="创建索引例题"><a href="#创建索引例题" class="headerlink" title="创建索引例题"></a>创建索引例题</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f2ea9ccf33c740d58576608940981807?tpId=240&tqId=2223570&ru=/practice/f2ea9ccf33c740d58576608940981807&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/company">https://www.nowcoder.com/practice/f2ea9ccf33c740d58576608940981807?tpId=240&amp;tqId=2223570&amp;ru=%2Fpractice%2Ff2ea9ccf33c740d58576608940981807&amp;qru=%2Fta%2Fsql-advanced%2Fquestion-ranking&amp;sourceUrl=%2Fexam%2Fcompany</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_duration ON examination_info(duration); # 普通索引</span><br><span class="line">CREATE FULLTEXT INDEX full_idx_tag ON examination_info(tag);  # 全文索引</span><br><span class="line">CREATE UNIQUE INDEX uniq_idx_exam_id ON examination_info(exam_id); # 唯一性索引</span><br></pre></td></tr></table></figure>

<h3 id="删除索引例题"><a href="#删除索引例题" class="headerlink" title="删除索引例题"></a>删除索引例题</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/4963f6d63dde48d787aaa2b43460fb4b?tpId=240&tags=&title=&difficulty=0&judgeStatus=0&rp=0&sourceUrl=/exam/company">https://www.nowcoder.com/practice/4963f6d63dde48d787aaa2b43460fb4b?tpId=240&amp;tags=&amp;title=&amp;difficulty=0&amp;judgeStatus=0&amp;rp=0&amp;sourceUrl=%2Fexam%2Fcompany</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX uniq_idx_exam_id ON examination_info;</span><br><span class="line">DROP INDEX full_idx_tag ON examination_info;</span><br></pre></td></tr></table></figure>





<p>对比是否使用索引的查询方式和查询数据量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 解释语句的执行过程</span><br><span class="line">mysql&gt; explain select * from emp where sal = 5000;</span><br><span class="line"># type字段为all，表示全表扫描；rows=14，表示扫描了14行才扫到。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 为sal字段创建索引</span><br><span class="line">mysql&gt; create index emp_sal_index on emp(sal);</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line">mysql&gt; explain select * from emp where sal = 5000;</span><br><span class="line"># type字段为ref，表示索引扫描；rows=1，表示扫描了1行就扫到了。</span><br></pre></td></tr></table></figure>

<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.nowcoder.com/practice/f2ea9ccf33c740d58576608940981807?tpId=240&tqId=2223570&ru=/practice/f2ea9ccf33c740d58576608940981807&qru=/ta/sql-advanced/question-ranking&sourceUrl=/exam/company">https://www.nowcoder.com/practice/f2ea9ccf33c740d58576608940981807?tpId=240&amp;tqId=2223570&amp;ru=%2Fpractice%2Ff2ea9ccf33c740d58576608940981807&amp;qru=%2Fta%2Fsql-advanced%2Fquestion-ranking&amp;sourceUrl=%2Fexam%2Fcompany</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_duration ON examination_info(duration); # 普通索引</span><br><span class="line">CREATE FULLTEXT INDEX full_idx_tag ON examination_info(tag);  # 全文索引</span><br><span class="line">CREATE UNIQUE INDEX uniq_idx_exam_id ON examination_info(exam_id); # 唯一性索引</span><br></pre></td></tr></table></figure>



<h2 id="索引原理"><a href="#索引原理" class="headerlink" title="索引原理"></a>索引原理</h2><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20230830192308964.png" alt="image-20230830192308964"></p>
<p>通过B Tree缩小扫描范围，底层索引进行了排序，分区，索引会携带数据在表中的“物理地址”，最终通过索引检索到数据之后，获取到关联的物理地址，通过物理地址定位表中的数据。<br>            select ename from emp where ename &#x3D; ‘SMITH’;<br>            通过索引转换为：<br>            select ename from emp where 物理地址 &#x3D; 0x3;</p>
<h2 id="索引分类（了解）"><a href="#索引分类（了解）" class="headerlink" title="索引分类（了解）"></a>索引分类（了解）</h2><ul>
<li>单一索引：单个字段</li>
<li>复合索引：多个字段</li>
<li>主键索引：</li>
<li>唯一索引：</li>
</ul>
<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><p>只是表的保密表现形式。</p>
<p>作用：视图可以隐藏表的实现细节。保密级别较高的系统，数据库只对外提供相关的视图，程序员只对视图对象进行CRUD。</p>
<p>视图对象只能用上述的DQL语句创建出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建视图</span><br><span class="line">create view myview as select 字段1,字段2 from 表;</span><br><span class="line"># 删除视图</span><br><span class="line">drop view myview;</span><br></pre></td></tr></table></figure>

<p>对视图进行增删改查CRUD会影响原表数据，但不是直接操作原表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table emp_bak as select * from emp;</span><br><span class="line">create view myview1 as select empno,ename,sal from emp_bak;</span><br><span class="line">update myview1 set ename=&#x27;hehe&#x27;,sal=1 where empno = 7369; # 通过视图修改原表数据。</span><br><span class="line">delete from myview1 where empno = 7369; # 通过视图删除原表数据。</span><br></pre></td></tr></table></figure>



<h1 id="DBA命令"><a href="#DBA命令" class="headerlink" title="DBA命令"></a>DBA命令</h1><h2 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; mysqldump 数据库名 表名（表名可省略） &gt; 路径\文件名.sql -uroot -p</span><br><span class="line">mysqldump dljd &gt; C:\Users\imcj0\Documents\export.sql -uroot -p</span><br></pre></td></tr></table></figure>

<h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database dljd_tmp;  # 创建数据库</span><br><span class="line">use dljd_tmp; #</span><br><span class="line">source C:\Users\imcj0\Documents\export.sql;</span><br></pre></td></tr></table></figure>



<h1 id="数据库设计三范式（重点）"><a href="#数据库设计三范式（重点）" class="headerlink" title="数据库设计三范式（重点）"></a>数据库设计三范式（重点）</h1><p>按照三范式设计的表不会出现数据冗余，在实际的开发中，以满足客户的需求为主，有的时候会拿冗余换执行速度。</p>
<ul>
<li>第一范式：任何一张表都应该有主键，并且每一个字段原子性不可再分。</li>
<li>第二范式：建立在第一范式的基础之上，所有非主键字段完全依赖主键，不能产生部分依赖。<ul>
<li>多对多关系，使用三张表，关系表两个外键：</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">t_student学生表</span><br><span class="line">sno(pk)		sname</span><br><span class="line">-------------------</span><br><span class="line">1			张三</span><br><span class="line">2			李四</span><br><span class="line">3			王五</span><br><span class="line"></span><br><span class="line">t_teacher 讲师表</span><br><span class="line">tno(pk)		tname</span><br><span class="line">---------------------</span><br><span class="line">1			王老师</span><br><span class="line">2			张老师</span><br><span class="line">3			李老师</span><br><span class="line"></span><br><span class="line">t_student_teacher_relation 学生讲师关系表</span><br><span class="line">id(pk)		sno(fk)		tno(fk)</span><br><span class="line">----------------------------------</span><br><span class="line">1			1			3</span><br><span class="line">2			1			1</span><br><span class="line">3			2			2</span><br><span class="line">4			2			3</span><br><span class="line">5			3			1</span><br><span class="line">6			3			3</span><br></pre></td></tr></table></figure>

<ul>
<li><p>建立在第二范式的基础之上，所有非主键字段直接依赖主键，不能产生传递依赖。</p>
<ul>
<li><p>一对多关系，使用两张表，多的表加外键。</p>
<p>如果不遵循第三范式，那么t_class的cname会在t_student中的cname字段，而此时该字段不依赖主键sno。</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">班级t_class</span><br><span class="line">cno(pk)			cname</span><br><span class="line">--------------------------</span><br><span class="line">1				班级1</span><br><span class="line">2				班级2</span><br><span class="line"></span><br><span class="line">学生t_student</span><br><span class="line">sno(pk)			sname				classno(fk)</span><br><span class="line">---------------------------------------------</span><br><span class="line">101				张1				1</span><br><span class="line">102				张2				1</span><br><span class="line">103				张3				2</span><br><span class="line">104				张4				2</span><br><span class="line">105				张5				2</span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<p>一对一设计：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">t_user_login  用户登录表</span><br><span class="line">id(pk)		username		password</span><br><span class="line">--------------------------------------</span><br><span class="line">1			zs				123</span><br><span class="line">2			ls				456</span><br><span class="line"></span><br><span class="line">t_user_detail 用户详细信息表</span><br><span class="line">id(pk+fk)	realname		tel			....</span><br><span class="line">------------------------------------------------</span><br><span class="line">1			张三			1111111111</span><br><span class="line">2			李四			1111415621</span><br><span class="line"></span><br><span class="line">一对一设计有两种方案：外键唯一。</span><br><span class="line">t_user_login  用户登录表</span><br><span class="line">id(pk)		username		password</span><br><span class="line">--------------------------------------</span><br><span class="line">1			zs				123</span><br><span class="line">2			ls				456</span><br><span class="line"></span><br><span class="line">t_user_detail 用户详细信息表</span><br><span class="line">id(pk)	   realname			tel				userid(fk+unique)....</span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">1			张三			1111111111			2</span><br><span class="line">2			李四			1111415621			1</span><br><span class="line">			</span><br></pre></td></tr></table></figure>



<h1 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h1><p>确定两个概念：<strong>日期和时间</strong>。</p>
<p>格式</p>
<ul>
<li>DATE：仅包含日期部分，格式为’YYYY-MM-DD’，例如’2023-07-06’。</li>
<li>TIME：仅包含时间部分，格式为’HH:MM:SS’，例如’13:30:45’。</li>
<li>DATETIME：包含日期和时间部分，格式为’YYYY-MM-DD HH:MM:SS’，例如’2023-07-06 13:30:45’。</li>
<li>TIMESTAMP：与DATETIME相似，格式为’YYYY-MM-DD HH:MM:SS’，但在存储和使用上有一些差异。</li>
</ul>
<h3 id="日期函数："><a href="#日期函数：" class="headerlink" title="日期函数："></a>日期函数：</h3><ul>
<li><p><code>CURDATE()</code> <code>CURRENT_DATE()</code>，返回当前日期</p>
</li>
<li><p><code>CURTIME()</code> <code>CURRENT_TIME()</code>，返回当前时间</p>
</li>
<li><p><code>NOW() </code> <code>CURRENT_TIMESTAMP()</code>，返回当前日期和时间</p>
</li>
<li><p><code>DATA_FORMAT()</code>，格式化符号来表示年、月、日、小时、分钟、秒。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_FORMAT(NOW(), &#x27;%Y-%m-%d %H:%i:%s&#x27;); </span><br><span class="line"># 2023-09-01 23:25:07</span><br><span class="line">SELECT DATE_FORMAT(NOW(), &#x27;%W, %M %e, %Y&#x27;);</span><br><span class="line"># Friday, September 1, 2023 </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="日期运算符"><a href="#日期运算符" class="headerlink" title="日期运算符"></a>日期运算符</h3><ul>
<li><p><code>DATE_ADD()</code> <code>DATE_SUB()</code>，当前日期减去一定时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_ADD(NOW(), INTERVAL 2 DAY); </span><br><span class="line">SELECT DATE_SUB(NOW(), INTERVAL 1 MINUTE); </span><br></pre></td></tr></table></figure>
</li>
<li><p><code>DATEDIFF()</code>，计算两个日期<strong>天数（d）</strong>之差</p>
</li>
<li><p><code>TIMEDIFF()</code>，计算两个日期<strong>时间（h,m,s）</strong>之差</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATEDIFF(DATE_SUB(NOW(), INTERVAL 10 DAY), NOW());  # -10</span><br></pre></td></tr></table></figure>


</li>
<li><p><code>timestampdiff(unit,begin,end)</code></p>
<ul>
<li><p>TIMESTAMPDIFF函数返回begin-end的结果，其中begin和end是DATE或DATETIME表达式。</p>
<p>TIMESTAMPDIFF函数允许其参数具有混合类型，例如，begin是DATE值，end可以是DATETIME值。 如果使用DATE值，则TIMESTAMPDIFF函数将其视为时间部分为“00:00:00”的DATETIME值</p>
</li>
<li><p>unit则为返回的单位</p>
<ul>
<li>MICROSECOND</li>
<li>SECOND</li>
<li>MINUTE</li>
<li>HOUR</li>
<li>DAY</li>
<li>WEEK</li>
<li>MONTH</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="从时间中获取其中的一部分，比如只获取小时、月份等。"><a href="#从时间中获取其中的一部分，比如只获取小时、月份等。" class="headerlink" title="从时间中获取其中的一部分，比如只获取小时、月份等。"></a>从时间中获取其中的一部分，比如只获取小时、月份等。</h3><ul>
<li><p><code>YEAR() MONTH() DAY() HOUR() MINUTE() SECOND()</code>，获取日期+时间中的对应部分。</p>
</li>
<li><p><code>DATE()</code>，获取日期+时间的<strong>日期</strong>部分，格式化的数据也能获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE(NOW()); # 成功</span><br><span class="line">SELECT DATE(DATE_FORMAT(NOW(), &#x27;%Y-%m-%d %H:%i:%s&#x27;)); # 成功</span><br><span class="line">SELECT DATE(DATE_FORMAT(NOW(), &#x27;%Y-%m&#x27;)); # null</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>TIME()</code>，获取日期+时间的<strong>时间</strong>部分</p>
</li>
<li><p><code>DATENAME()</code> <code>MONTHNAME()</code> 获取星期&#x2F;月份的全称。</p>
</li>
<li><p><code>LAST_DAY()</code>返回日期参数的某月最后一天</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/0643165177d6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/0643165177d6/" class="post-title-link" itemprop="url">git的使用、报错与解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-17 10:42:07" itemprop="dateCreated datePublished" datetime="2023-11-17T10:42:07+08:00">2023-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-01-12 21:37:03" itemprop="dateModified" datetime="2024-01-12T21:37:03+08:00">2024-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Commit"><a href="#Commit" class="headerlink" title="Commit"></a>Commit</h1><p>1、规范<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chonglu/p/15693950.html">https://www.cnblogs.com/chonglu/p/15693950.html</a></p>
<p>2、撤销上一次的commit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把 HEAD 指针移回上一个提交（HEAD~1），并清除最后一次提交的内容。</span></span><br><span class="line">git reset HEAD~1  <span class="comment"># git reset HEAD~</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤回n次</span></span><br><span class="line">git reset HEAD~n</span><br></pre></td></tr></table></figure>





<h2 id="报错1"><a href="#报错1" class="headerlink" title="报错1"></a>报错1</h2><p>当pull遇到如下错误时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; PS E:\_code\go_project\interpreter_in_Go-master&gt; git pull remote main:master</span><br><span class="line">From https://github.com/drinkwateronly/interpreter_in_Go</span><br><span class="line"> ! [rejected]        main       -&gt; master  (non-fast-forward)</span><br></pre></td></tr></table></figure>

<p>github上的肯定是最新的代码，可能的原因是本机的代码添加了无关紧要的注释，且添加前没有pull，造成的冲突导致的。</p>
<p>此时的解决方案是将remote的main分支，pull到本机新建的main branch中，然后切换到main分支，将原分支master删除。此做法只适合本机没有更新代码的情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; git pull remote main:main</span><br><span class="line">&gt; git checkout main</span><br><span class="line">&gt; git branch -D master </span><br></pre></td></tr></table></figure>





<p>fatal: unable to access ‘<a target="_blank" rel="noopener" href="https://github.com/drinkwateronly/gstonegames_Spider_in_Go.git/">https://github.com/drinkwateronly/gstonegames_Spider_in_Go.git/</a>‘: Recv failure: Connection was reset ：</p>
<p>git config –global http.proxy <a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890</a><br>git config –global https.proxy <a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f  强推</span><br></pre></td></tr></table></figure>





<h2 id="错误-HTTP-408"><a href="#错误-HTTP-408" class="headerlink" title="错误 HTTP 408"></a>错误 HTTP 408</h2><p>主要原因：文件太大&#x2F;太多，缓存不够</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kanbarakun/article/details/134390526">https://blog.csdn.net/kanbarakun/article/details/134390526</a></p>
</blockquote>
<blockquote>
<p>error: RPC failed; HTTP 408 curl 22 The requested URL returned error: 408<br>send-pack: unexpected disconnect while reading sideband packet<br>fatal: the remote end hung up unexpectedly<br>Everything up-to-date<br>FATAL Something’s wrong. Maybe you can find the solution here: <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">https://hexo.io/docs/troubleshooting.html</a><br>Error: Spawn failed<br>    at ChildProcess.<anonymous> (C:\Users\wallnut\myBlog\node_modules\hexo-deployer-git\node_modules\hexo-util\lib\spawn.js:51:21)<br>    at ChildProcess.emit (node:events:513:28)<br>    at cp.emit (C:\Users\wallnut\myBlog\node_modules\cross-spawn\lib\enoent.js:34:29)<br>    at ChildProcess._handle.onexit (node:internal&#x2F;child_process:291:12)</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.postBuffer <span class="number">524288000</span>  </span><br><span class="line"># 或者  </span><br><span class="line">git config http.postBuffer <span class="number">524288000</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/842d843bf492/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/842d843bf492/" class="post-title-link" itemprop="url">ch4 指令系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-17 10:42:07 / 修改时间：19:15:48" itemprop="dateCreated datePublished" datetime="2023-11-17T10:42:07+08:00">2023-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/408/" itemprop="url" rel="index"><span itemprop="name">408</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/408/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">计算机组成原理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="指令系统"><a href="#指令系统" class="headerlink" title="指令系统"></a>指令系统</h1><ul>
<li><strong>指令&#x2F;机器指令</strong>定义：指计算机执行某种操作的命令，是计算机运行最小功能单位。</li>
<li>所有指令的集合构成该机的指令系统叫<strong>指令集</strong>。不同计算机指令集一般不同，不兼容。</li>
<li>一条指令就是机器语言的一个语句。有意义的二进制代码。</li>
<li>指令字长与机器字长没有固定关系，可以相同，可以不同</li>
</ul>
<h2 id="4-1-指令格式"><a href="#4-1-指令格式" class="headerlink" title="4.1 指令格式"></a>4.1 指令格式</h2><p>基本是根据操作码的长度、功能分类</p>
<h3 id="4-1-1-基本格式"><a href="#4-1-1-基本格式" class="headerlink" title="4.1.1  基本格式"></a>4.1.1  基本格式</h3><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/clip_image002.jpg" alt="img"></p>
<p>根据地址码数目不同、分为以下格式</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231102123621389.png" alt="image-20231102123621389"></p>
<h3 id="4-1-2-定长操作码指令格式"><a href="#4-1-2-定长操作码指令格式" class="headerlink" title="4.1.2  定长操作码指令格式"></a>4.1.2  定长操作码指令格式</h3><p>高位部分分配固定n位表示操作码，那么操作系统最多有2^n条指令，简化硬件设计，提高指令译码速度。机器字长为32位及以上时的常规用法。</p>
<h3 id="4-1-3-拓展操作码指令格式"><a href="#4-1-3-拓展操作码指令格式" class="headerlink" title="4.1.3 拓展操作码指令格式"></a>4.1.3 拓展操作码指令格式</h3><p>有限指令字长时，为了保持比较丰富的指令种类，使得操作码不定长。增加译码和控制的复杂度。</p>
<ul>
<li>不允许短操作码是长操作码前缀，操作码不能重复。</li>
<li>且一般使用频率高的操作码设计为短操作码，使用频率低分配长操作码。减少指令译码分析时间</li>
</ul>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231102124310112.png" alt="image-20231102124310112"></p>
<blockquote>
<p>例题</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231102125310339.png" alt="image-20231102125310339"></p>
</blockquote>
<h3 id="4-1-4-指令类型"><a href="#4-1-4-指令类型" class="headerlink" title="4.1.4 指令类型"></a>4.1.4 指令类型</h3><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231102125005456.png" alt="image-20231102125005456"></p>
<h2 id="4-2指令的寻址方式"><a href="#4-2指令的寻址方式" class="headerlink" title="4.2指令的寻址方式"></a>4.2指令的寻址方式</h2><p>确定本条指令的数据地址（数据寻址）以及下一条待执行指令的地址（指令寻址）。</p>
<h3 id="4-2-1-指令寻址"><a href="#4-2-1-指令寻址" class="headerlink" title="4.2.1 指令寻址"></a>4.2.1 指令寻址</h3><h4 id="1、顺序寻址"><a href="#1、顺序寻址" class="headerlink" title="1、顺序寻址"></a>1、顺序寻址</h4><p>程序计数器PC+1自动形成下一条指令的地址。</p>
<h4 id="2、跳跃寻址"><a href="#2、跳跃寻址" class="headerlink" title="2、跳跃寻址"></a>2、跳跃寻址</h4><p>通过转移类的指令，如JMP，由本条指令指出下一条指令的地址（绝对地址和相对地址）。跳跃的结果修改PC。所以下一条指令地址仍然由PC给出。</p>
<h3 id="4-2-2-数据寻址（10种）"><a href="#4-2-2-数据寻址（10种）" class="headerlink" title="4.2.2 数据寻址（10种）"></a>4.2.2 数据寻址（10种）</h3><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103102028653.png" alt="image-20231103102028653"></p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103102156837.png" alt="image-20231103102156837"></p>
<h4 id="1、隐含寻址"><a href="#1、隐含寻址" class="headerlink" title="1、隐含寻址"></a>1、隐含寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103092204441.png" alt="image-20231103092204441"></p>
<p>不给出操作数地址，而是根据操作码知道，</p>
<ul>
<li>有利于缩短指令字长</li>
<li>增加存储操作数或隐含地址的硬件。</li>
</ul>
<p>如ADD指令，该指令只给出了第一操作数的地址A，而隐含了累加器ACC的地址作为第二操作数地址。</p>
<h4 id="2、立即（数）寻址"><a href="#2、立即（数）寻址" class="headerlink" title="2、立即（数）寻址"></a>2、立即（数）寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103092555957.png" alt="image-20231103092555957"></p>
<p>指令字的地址字段不是操作数地址，而是操作数本身，采用补码表示。</p>
<ul>
<li>优：指令执行不用访问主存，执行速度最快</li>
<li>缺：位数限制数据的范围</li>
</ul>
<h4 id="3、直接寻址"><a href="#3、直接寻址" class="headerlink" title="3、直接寻址"></a>3、直接寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103092603583.png" alt="image-20231103092603583"></p>
<p>指令字的地址字段（形式地址A）就是操作数的真实地址EA，即EA &#x3D; A。</p>
<ul>
<li>优：简单，只访问一次主存，</li>
<li>缺：位数限制寻址范围，操作数地址不易修改？</li>
</ul>
<h4 id="4、间接寻址"><a href="#4、间接寻址" class="headerlink" title="4、间接寻址"></a>4、间接寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103093243805.png" alt="image-20231103093243805"></p>
<p>指令字的地址字段（形式地址A）就是操作数<strong>的地址的地址</strong>，，即EA &#x3D; (A)。</p>
<ul>
<li>可以<strong>扩大寻址范围</strong>，因为EA大于A；便于编制程序（方便完成子程序返回）</li>
<li>一次执行指令可能需要多次访存，慢，不常用。</li>
</ul>
<h4 id="5、寄存器寻址"><a href="#5、寄存器寻址" class="headerlink" title="5、寄存器寻址"></a>5、寄存器寻址</h4><p>指令字的地址字段 是 操作数所在的寄存器编号，即EA &#x3D; R</p>
<ul>
<li>优：指令字短，不访问主存，快；支持向量&#x2F;矩阵运算。</li>
<li>缺：寄存器贵，且数量有限。</li>
</ul>
<h4 id="6、寄存器间接寻址"><a href="#6、寄存器间接寻址" class="headerlink" title="6、寄存器间接寻址"></a>6、寄存器间接寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103094000331.png" alt="image-20231103094000331"></p>
<p>指令字的地址字段是 操作数的内存地址所在的寄存器编号，即EA &#x3D; (R)。类似间接寻址，</p>
<ul>
<li>比一次间接寻址快，因为只访问一次主存。</li>
</ul>
<h4 id="7、相对寻址"><a href="#7、相对寻址" class="headerlink" title="7、相对寻址"></a>7、相对寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103094316188.png" alt="image-20231103094316188"></p>
<p>指令字的地址字段是一个相对地址，操作数就存在相对于PC所指地址的相对地址上。即EA &#x3D; (PC) + A。</p>
<blockquote>
<p>CPU取出指令的一个字节后，自动执行(PC) + 1 -&gt; PC。</p>
<p>若JMP A的指令的地址为X，且占2B，那么取出该地址后PC &#x3D; X+2；执行这条指令后，自动跳转到 X+2+A的相对地址执行。</p>
</blockquote>
<ul>
<li>指令和数据相差一个固定值，便于程序浮动。</li>
<li>A的位数决定寻址范围。</li>
</ul>
<h4 id="8、基址寻址"><a href="#8、基址寻址" class="headerlink" title="8、基址寻址"></a>8、基址寻址</h4><p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103095829138.png" alt="image-20231103095829138"></p>
<p><code>CPU中基址寄存器BR的内容  + 指令字地址字段的形式地址A = 操作数有效地址</code>。即<code>EA = (BR) + A</code>。</p>
<p>面向操作系统：</p>
<ul>
<li><p>用户可以决定是哪个寄存器作为BR，如专用寄存器、通用寄存器。</p>
</li>
<li><p>BR的内容由操作系统决定，所以用户无需关心程序在主存的哪个位置。</p>
</li>
<li><p>程序运行时，BR内容作为基地址不变，A作为偏移地址可改变。</p>
</li>
<li><p>优点：可扩大寻址范围，BR位数&gt;A位数；有利于多道程序设计，编制浮动程序，解决了程序逻辑地址与存储器物理地址的无关性。</p>
</li>
<li><p>缺点：偏移量仍然较短。</p>
</li>
</ul>
<h4 id="9、变址寻址"><a href="#9、变址寻址" class="headerlink" title="9、变址寻址"></a>9、变址寻址</h4><p><code>变址寄存器IX内容 + 指令字地址字段的形式地址A = 操作数有效地址</code>。即<code>EA = (IX) + A</code></p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103100244722.png" alt="image-20231103100244722"></p>
<p>面向用户：</p>
<ul>
<li><p>用户可以决定是哪个寄存器作为IX，如专用寄存器、通用寄存器。</p>
</li>
<li><p>IX内容由用户设定</p>
</li>
<li><p>程序运行时，IX内容可以被改变，<strong>但形式地址A作为基地址不变</strong>。</p>
</li>
<li><p>优点：扩大寻址范围，IX位数&gt;A位数，IX位数足以表示整个存储空间。</p>
</li>
<li><p>适合编制循环程序；解决数组问题：设定A固定，不断改变IX，很容易形成数组任意数据的位置</p>
</li>
</ul>
<h4 id="10、堆栈寻址"><a href="#10、堆栈寻址" class="headerlink" title="10、堆栈寻址"></a>10、堆栈寻址</h4><p>存储器或专用寄存器组的LIFO存储区。读这个堆栈的地址由堆栈指针寄存器SP指出。</p>
<ul>
<li>硬堆栈：寄存器构成，成本高，容量小</li>
<li>软堆栈：主存划分的区域，常用</li>
</ul>
<p>采用堆栈结构的系统，大多数指令都是无操作数，隐含使用SP。</p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><blockquote>
<ul>
<li><p>基址寻址搭配变址寻址:EA&#x3D;A+(BR)+(IX)既能保证程序浮动，程序内又能实现循环。</p>
</li>
<li><p>变址寻址搭配间址寻址：</p>
<ul>
<li>先变址后间址：EA&#x3D;(A+(IX))</li>
<li>先间址后变址：EA&#x3D;(A)+(IX)</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="4-4-CISC-RISC"><a href="#4-4-CISC-RISC" class="headerlink" title="4.4 CISC &amp; RISC"></a>4.4 CISC &amp; RISC</h2><p>复杂&#x2F;精简指令集系统计算机</p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103102625534.png" alt="image-20231103102625534"></p>
<p><img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/image/image-20231103102639847.png" alt="image-20231103102639847"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/e10b2052a6a6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/e10b2052a6a6/" class="post-title-link" itemprop="url">ch10-错误处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-17 00:00:00 / 修改时间：19:48:28" itemprop="dateCreated datePublished" datetime="2023-11-17T00:00:00+08:00">2023-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/Go%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Go基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第十章-错误处理"><a href="#第十章-错误处理" class="headerlink" title="第十章 错误处理"></a>第十章 错误处理</h1><p>go使用函数的返回值来处理错误，如果返回nil，则表示没有错误。</p>
<h2 id="10-2-自定义错误"><a href="#10-2-自定义错误" class="headerlink" title="10.2 自定义错误"></a>10.2 自定义错误</h2><p><strong>go语言常量要是编译时就能确定的数据，errors.New(“xxx”) 要等到运行时才能确定，所以不能作为常量</strong></p>
<h3 id="10-2-1-错误类型"><a href="#10-2-1-错误类型" class="headerlink" title="10.2.1 错误类型"></a>10.2.1 错误类型</h3><p>error类型实际是个接口，error接口包含Error方法，调用这个方法就会返回一个字符串，这个字符串是显示当前的错误详情。</p>
<p>自定一个类型，类型实现了Error方法，它就实现了error接口，就是一个自定义的错误。</p>
<p>和struct一样，用<code>type</code>关键字定义一个错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">error</span> <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-2-创建错误"><a href="#10-2-2-创建错误" class="headerlink" title="10.2.2 创建错误"></a>10.2.2 创建错误</h3><p>来自标准库的errors包，可以自定义错误内容</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := errors.New(<span class="string">&quot;this is an error&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="10-2-3-格式化错误格式"><a href="#10-2-3-格式化错误格式" class="headerlink" title="10.2.3 格式化错误格式"></a>10.2.3 格式化错误格式</h3><p>来自标准库fmt包的<code>Errorf</code>方法，也是生成一个错误对象，但可以设置返回的错误字符串的内容格式（即可以添加变量）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Errorf</span><span class="params">(format <span class="type">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> errors.New(Sprintf(format, a...)) <span class="comment">// 内部实际上也是调用了errors包</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>demo：</p>
<p>runtime包中的<code>runtime.Caller(0)</code>获取了当前代码所在行数。然后由fmt的Errorf()将行数格式化进错误信息中，再由错误对象调用Error()方法返回错误信息。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> _, _, line, ok := runtime.Caller(<span class="number">0</span>); ok == <span class="literal">true</span> &#123;</span><br><span class="line">	err := fmt.Errorf(<span class="string">&quot;***Line %d error***&quot;</span>, line)</span><br><span class="line">	fmt.Println(err.Error())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="10-3-宕机"><a href="#10-3-宕机" class="headerlink" title="10.3 宕机"></a>10.3 宕机</h2><p>当程序发出<strong>不可逆</strong>的错误，会使用内置函数panic方法触发宕机，中断程序。调用panic方法后的代码无效。</p>
<p>panic会直接将错误打印。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;Serious Bug&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;this is a invalid code&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-4-宕机恢复"><a href="#10-4-宕机恢复" class="headerlink" title="10.4 宕机恢复"></a>10.4 宕机恢复</h2><h3 id="10-4-1-捕获宕机"><a href="#10-4-1-捕获宕机" class="headerlink" title="10.4.1 捕获宕机"></a>10.4.1 捕获宕机</h3><p>在panic后，<strong>会执行defer语句</strong>。此处需要注意panic后程序执行的流程，除了main中的defer，可以看出<code>paincCode()</code>里的匿名函数的defer也被执行了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panicCode</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 匿名函数</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;func panicCode() exit&quot;</span>) <span class="comment">// 1</span></span><br><span class="line">	&#125;() </span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;bug&quot;</span>) <span class="comment">// painc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 匿名函数</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;main() exit&quot;</span>) <span class="comment">// 2</span></span><br><span class="line">	&#125;()</span><br><span class="line">	panicCode()</span><br><span class="line">	fmt.Println(<span class="string">&quot;test&quot;</span>) <span class="comment">// no appear</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以利用到defer语句+ 匿名函数+ recover方法捕获宕机。</p>
<ul>
<li>触发panic后，执行defer，defer指向匿名函数，匿名函数里使用recover捕获。</li>
</ul>
<p>使用recover函数，可以让进入宕机流程中的 goroutine 恢复过来，recover 仅在延迟函数 defer 中有效，类似try-catch机制。</p>
<h3 id="10-4-2-recover的应用"><a href="#10-4-2-recover的应用" class="headerlink" title="10.4.2 recover的应用"></a>10.4.2 recover的应用</h3><p>实际编程中会专门封装一个函数，以一种较安全的方式运行传入的方法，即使发生panic，主程序仍继续运行。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">protect</span><span class="params">(f <span class="keyword">func</span>()</span></span>) &#123;  <span class="comment">// protect()的参数是一个函数</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123; <span class="comment">// recover捕获宕机</span></span><br><span class="line">            <span class="comment">//recover函数获取panic的传入参数</span></span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	f() <span class="comment">// 让f运行</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	protect(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;  <span class="comment">// 传入匿名函数1 并panic</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;func 1&quot;</span>)</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;Bug in func 1&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	protect(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 传入匿名函数2 并panic</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;func 2&quot;</span>)</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;Bug in func 2&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(<span class="string">&quot;test&quot;</span>) <span class="comment">// 仍会被运行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-5-error的简单应用"><a href="#10-5-error的简单应用" class="headerlink" title="10.5 error的简单应用"></a>10.5 error的简单应用</h3><p>panic和recover能模拟其他语言的try-catch机制，但不建议使用，推荐使用多值返回来返回错误。不过我挺喜欢try-catch方式。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(dividend <span class="type">int</span>, divisor <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> divisor == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;divisor is zero&quot;</span>) <span class="comment">// 返回一个error</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dividend / divisor, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    res1, err := div(<span class="number">4</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(res1)  <span class="comment">// 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    res2, err := div(<span class="number">4</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err.Error()) <span class="comment">//divisor is zero</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(res2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="10-7-error接口的应用"><a href="#10-7-error接口的应用" class="headerlink" title="10.7 error接口的应用"></a>10.7 error接口的应用</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ErrZeroDivisor <span class="type">int</span> <span class="comment">// 自定义类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e ErrZeroDivisor)</span></span> Error() <span class="type">string</span> &#123; <span class="comment">// 实现Error()方法</span></span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;Divisor is %d&quot;</span>, e) <span class="comment">// Error()方法返回的字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div1</span><span class="params">(dividend <span class="type">int</span>, divisor <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> divisor == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, ErrZeroDivisor(<span class="number">0</span>) <span class="comment">// 此处的调用方式暂未见过 留有疑问？</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dividend / divisor, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	_, error1 := div1(<span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line">	_, error2 := div1(<span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">	fmt.Println(error1)</span><br><span class="line">	fmt.Println(error2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drinkwateronly.github.io/2023/11/8c1b64ea2c6a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Wallnut">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wallnut">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Wallnut">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/8c1b64ea2c6a/" class="post-title-link" itemprop="url">ch11-文件操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-11-17 00:00:00 / 修改时间：19:48:34" itemprop="dateCreated datePublished" datetime="2023-11-17T00:00:00+08:00">2023-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/Go%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Go基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第11章-文件操作"><a href="#第11章-文件操作" class="headerlink" title="第11章 文件操作"></a>第11章 文件操作</h1><p>文件分为两类：文本文件和二进制文件。<br>windows目录不区分大小写，Unix区分。<br>windows每个盘都是自己的根目录，Unix只有<code>/</code>一个根目录。<br>I&#x2F;O操作封装在：</p>
<ul>
<li>io—— 为I&#x2F;O<strong>原语</strong>提供基本的接口</li>
<li>io&#x2F;ioutil—— 封装实用I&#x2F;O函数，也是本章重点</li>
<li>fmt —— 格式化I&#x2F;O</li>
<li>bufio —— 带缓冲I&#x2F;O</li>
</ul>
<h2 id="11-1-目录基本操作"><a href="#11-1-目录基本操作" class="headerlink" title="11.1 目录基本操作"></a>11.1 目录基本操作</h2><h3 id="11-1-1-目录"><a href="#11-1-1-目录" class="headerlink" title="11.1.1 目录"></a>11.1.1 目录</h3><p>io&#x2F;ioutil库中有关目录的方法已经在Go 1.16弃用。</p>
<p>采用os库</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 删除目录</span></span><br><span class="line">os.RemoveAll(path <span class="type">string</span>)</span><br><span class="line"><span class="comment">// 获取当前工作目录</span></span><br><span class="line">os.Getwd()</span><br><span class="line"><span class="comment">// 切换当前工作目录</span></span><br><span class="line">os.Chdir(path <span class="type">string</span>)</span><br><span class="line"><span class="comment">// 获取临时目录？</span></span><br><span class="line">os.TempDir()</span><br><span class="line"><span class="comment">// 读取目录</span></span><br><span class="line">os.ReadDir(name <span class="type">string</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="11-1-3-目录操作"><a href="#11-1-3-目录操作" class="headerlink" title="11.1.3 目录操作"></a>11.1.3 目录操作</h3><p>来自os库</p>
<h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Mkdir</span><span class="params">(name <span class="type">string</span>, perm FileMode)</span></span> <span class="type">error</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MkdirAll</span><span class="params">(name <span class="type">string</span>, perm FileMode)</span></span> <span class="type">error</span> <span class="comment">// &quot;a/aa/aaa&quot; 多级目录</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Mkdir</code>只能创建一个一级目录，文件存在会创建失败返回错误；权限不足，也会创建失败</li>
<li><code>MkdirAll</code>能创建多级目录，目录存在返回nil，且不做操作。成功了都会返回nil。</li>
</ul>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Remove</span><span class="params">(name <span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RemoveAll</span><span class="params">(name <span class="type">string</span>)</span></span> <span class="type">error</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Remove</code>只能删除空文件夹，非空返回错误；</p>
</li>
<li><p><code>RemoveAll</code>删除指定的文件，或目录及它包含的任何下级对象，指定对象不存在（其实也算删除成功），返回nil。</p>
<p>成功了都会返回nil。</p>
</li>
</ul>
<h4 id="判断目录或文件是否存在"><a href="#判断目录或文件是否存在" class="headerlink" title="判断目录或文件是否存在"></a>判断目录或文件是否存在</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Stat</span><span class="params">(name <span class="type">string</span>)</span></span> (fi FileInfo, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>成功，返回描述文件对象的<code>FileInfo</code>，返回nil</li>
<li>若对象是个符号链接，返回符号链接指向的文件的<code>FileInfo，返回nil</code></li>
<li>出错，返回<code>*PathError</code>类型错误</li>
</ul>
<p>具体判断某文件是否存在，是用<code>Stat()</code>的返回的error确定</p>
<ul>
<li>如果error&#x3D;&#x3D;nil，文件&#x2F;文件夹存在</li>
<li>对返回的<code>os.IsNotExist(error)==true </code>，文件夹不存在</li>
<li>其他情况，不确定存在不存在</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fi, err := os.Stat(<span class="string">&quot;E:\\GoWorks\\3.jpg&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;文件夹存在&quot;</span>)</span><br><span class="line">    fmt.Println(fi.IsDir())</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;文件不存在&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;不确定存不存在&quot;</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="创建删除目录例程"><a href="#创建删除目录例程" class="headerlink" title="创建删除目录例程"></a>创建删除目录例程</h4><ul>
<li><code>isAll</code>决定是否是带All的目录操作</li>
<li><code>os.Mkdir</code>能设置创建目录权限，但可能失败，所以还用了<code>os.Chmod</code>。<a target="_blank" rel="noopener" href="https://www.codenong.com/41565192/">关于go：设置os.Mkdir权限 | 码农家园 (codenong.com)</a><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createDir</span><span class="params">(path <span class="type">string</span>, dirName <span class="type">string</span>, isAll <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">	dirPath := path + <span class="string">&quot;\\&quot;</span> + dirName</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">if</span> isAll &#123;</span><br><span class="line">		err = os.MkdirAll(dirPath, <span class="number">0777</span>) <span class="comment">// 可以增加多级</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		err = os.Mkdir(dirPath, <span class="number">0777</span>) <span class="comment">// 只能增加一级</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		os.Chmod(dirPath, <span class="number">0777</span>) <span class="comment">// 对创建的文件夹chmod</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;Create Dit =&gt;&quot;</span> + path + dirName)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteDir</span><span class="params">(dirPath <span class="type">string</span>, isAll <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Delete Dir =&gt;&quot;</span> + dirPath)</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">if</span> isAll &#123;</span><br><span class="line">		err = os.Remove(dirPath) <span class="comment">// 可以删除多级</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		err = os.RemoveAll(dirPath) <span class="comment">// 只能删除一级</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Delete success&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rootPath := <span class="string">&quot;F:\\code\\GoWorks\\src\\GoTutorial\\ch11&quot;</span></span><br><span class="line">	createDir(rootPath, <span class="string">&quot;mkdir&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">	deleteDir(rootPath+<span class="string">&quot;\\mkdir&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">	createDir(rootPath, <span class="string">&quot;mkdir\\mkdirAll&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">	deleteDir(rootPath+<span class="string">&quot;\\mkdir\\mkdirAll&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="11-2-文件基本操作"><a href="#11-2-文件基本操作" class="headerlink" title="11.2 文件基本操作"></a>11.2 文件基本操作</h2><p>文件权限粒度：拥有者、所属组、其他组。每个粒度都能设置不同文件权限：<br> <img src="https://raw.githubusercontent.com/drinkwateronly/Image-Host/main/iimage/image-20230510000554747.png" alt="image-20230510000554747"></p>
<h3 id="11-2-1-文件的创建与打开"><a href="#11-2-1-文件的创建与打开" class="headerlink" title="11.2.1 文件的创建与打开"></a>11.2.1 文件的创建与打开</h3><h4 id="Open-和-Create"><a href="#Open-和-Create" class="headerlink" title="Open() 和 Create()"></a>Open() 和 Create()</h4><ul>
<li><code>Open</code>以读<code>O_RDONLY</code>形式打开文件</li>
<li><code>Create</code>采用<code>0666</code>（可读写不可执行）创建文件；如果文件存在，会清空文件内容；对应的文件描述符具有<code>O_RDWR</code>。</li>
<li>返回错误底层类型<code>*PathError</code><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(name <span class="type">string</span>)</span></span> (file *File, err <span class="type">error</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Create</span><span class="params">(name <span class="type">string</span>)</span></span> (file *File, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="OpenFile"><a href="#OpenFile" class="headerlink" title="OpenFile()"></a>OpenFile()</h4><p>来自os库，OpenFile比Open和Create<strong>更底层</strong>（他们俩都是调用OpenFile），会以指定的<strong>选项flag</strong>和<strong>模式perm</strong>打开文件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OpenFile</span><span class="params">(name <span class="type">string</span>, flag <span class="type">int</span>, perm FileMode)</span></span> (file *File, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>flag：访问模式 （并非所有操作系统都可用）<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line"> O_RDONLY <span class="type">int</span> = syscall.O_RDONLY <span class="comment">// 只读模式打开文件</span></span><br><span class="line"> O_WRONLY <span class="type">int</span> = syscall.O_WRONLY <span class="comment">// 只写模式打开文件</span></span><br><span class="line"> O_RDWR <span class="type">int</span> = syscall.O_RDWR <span class="comment">// 读写模式打开文件</span></span><br><span class="line"> <span class="comment">// O_RDONLY |  O_WRONLY 不等于 O_RDWR， 他们分别为0、1、2</span></span><br><span class="line">    </span><br><span class="line"> <span class="comment">// 前三个只指定一个，剩下由 | 连接指定</span></span><br><span class="line"> O_APPEND <span class="type">int</span> = syscall.O_APPEND <span class="comment">// 写操作时将数据附加到文件尾部</span></span><br><span class="line"> O_CREATE <span class="type">int</span> = syscall.O_CREAT <span class="comment">// 如果不存在将创建一个新文件</span></span><br><span class="line"> O_EXCL <span class="type">int</span> = syscall.O_EXCL <span class="comment">// 和O_CREATE配合使用，文件必须不存在</span></span><br><span class="line"> O_SYNC <span class="type">int</span> = syscall.O_SYNC <span class="comment">// 打开文件用于同步I/O</span></span><br><span class="line"> O_TRUNC <span class="type">int</span> = syscall.O_TRUNC <span class="comment">// 如果可能，打开时清空文件</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
<li>perm：位掩码参数 指定文件模式和权限位 （所有操作系统都一样）<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line"> <span class="comment">// 单字符是被 String 方法用于格式化的属性缩写</span></span><br><span class="line"> ModeDir FileMode = <span class="number">1</span> &lt;&lt; (<span class="number">32</span> - <span class="number">1</span> - <span class="literal">iota</span>) <span class="comment">// d: 目录</span></span><br><span class="line"> ModeAppend <span class="comment">// a: 只能写入，且只能写入到末尾</span></span><br><span class="line"> ModeExclusive <span class="comment">// l: 用于执行</span></span><br><span class="line"> ModeTemporary <span class="comment">// T: 临时文件（非备份文件）</span></span><br><span class="line"> ModeSymlink <span class="comment">// L: 符号链接（不是快捷方式文件）</span></span><br><span class="line"> ModeDevice <span class="comment">// D: 设备</span></span><br><span class="line"> ModeNamedPipe <span class="comment">// p: 命名管道（FIFO）</span></span><br><span class="line"> ModeSocket <span class="comment">// S: Unix域socket</span></span><br><span class="line"> ModeSetuid <span class="comment">// u: 表示文件具有其创建者用户id权限</span></span><br><span class="line"> ModeSetgid <span class="comment">// g: 表示文件具有其创建者组id的权限</span></span><br><span class="line"> ModeCharDevice <span class="comment">// c: 字符设备，需已设置ModeDevice</span></span><br><span class="line"> ModeSticky <span class="comment">// t: 只有root/创建者能删除/移动文件</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 覆盖所有类型位（用于通过&amp;获取类型位），对普通文件，所有这些位都不应被设置</span></span><br><span class="line"> ModeType = ModeDir | ModeSymlink | ModeNamedPipe | ModeSocket | </span><br><span class="line">ModeDevice</span><br><span class="line"> ModePerm FileMode = <span class="number">0777</span> <span class="comment">// 覆盖所有Unix权限位（用于通过&amp;获取类型位）</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
<li>实际上<code>Open()</code>和<code>Creat()</code>的底层就是<code>OpenFile()</code><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(name <span class="type">string</span>)</span></span> (＊File, <span class="type">error</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> OpenFile(name, O_RDONLY, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Create</span><span class="params">(name <span class="type">string</span>)</span></span> (＊File, <span class="type">error</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> OpenFile(name, O_RDWR|O_CREATE|O_TRUNC, <span class="number">0666</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="例程"><a href="#例程" class="headerlink" title="例程"></a>例程</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.OpenFile(rootPath+<span class="string">&quot;\\1.txt&quot;</span>, os.O_RDWR|os.O_CREATE, <span class="number">0766</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(file) <span class="comment">// &amp;&#123;0xc00010c780&#125;</span></span><br><span class="line">file.Close()</span><br></pre></td></tr></table></figure>



<h3 id="11-2-2-文件读取"><a href="#11-2-2-文件读取" class="headerlink" title="11.2.2 文件读取"></a>11.2.2 文件读取</h3><p>os库</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span></span> Read (b []<span class="type">byte</span>) (n <span class="type">int</span>, err <span class="type">error</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span></span> ReadAt (b []<span class="type">byte</span>, off <span class="type">int64</span>) (n <span class="type">int</span>, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Read</code>方法从文件中读取最多<code>len(b)</code>字节，写入byte数组b中，返回真正读取的字节数n，和err。文件终止的标志是读取n&#x3D;&#x3D;0个字节且返回值err为io.EOF。</li>
<li><code>ReadAt</code>和<code>Read</code>的区别是，从文件开始的字节偏移量off开始读，并且不会改变文件偏移量。<ul>
<li>循环<code>Read</code>一字节，文件能慢慢读到文件末尾，因为读1字节，偏移量自动往后移动1字节；</li>
<li>而循环<code>ReadAt</code>1字节，如果off固定，每次就只会从文件开始的off偏移读取，偏移量不会自动往后走，除非调用时改变off。</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(path <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	file, err := os.Open(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>) <span class="comment">// 每次读1024字节</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="built_in">len</span>, err := file.Read(buf)</span><br><span class="line">        <span class="comment">// len, err := file.ReadAt(buf, 1)</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span> == <span class="number">0</span> &#123;</span><br><span class="line">			fmt.Println(err) <span class="comment">// EOF</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="type">string</span>(buf))</span><br><span class="line">	&#125;</span><br><span class="line">	file.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-2-3-文件写入"><a href="#11-2-3-文件写入" class="headerlink" title="11.2.3 文件写入"></a>11.2.3 文件写入</h3><p>同样的，和读取类似，也有两个接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span></span> Write(b []<span class="type">byte</span>) (n <span class="type">int</span>, err <span class="type">error</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span></span> WriteAt(b []<span class="type">byte</span>, off <span class="type">int64</span>) (n <span class="type">int</span>, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>两种方法向文件中写入<code>len(b)</code>字节，如果返回值n!&#x3D;len(b)，就返回一个非nil错误。</li>
<li>两种方式都会覆盖原文件</li>
</ul>
<p>以下例程的两个函数的文件写入效果一样。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteFile</span><span class="params">(path <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	file, err := os.Create(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	data := <span class="string">&quot;data \n for \t writing!&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 偏移量自动改变</span></span><br><span class="line">		file.Write([]<span class="type">byte</span>(data))</span><br><span class="line">	&#125;</span><br><span class="line">	file.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteFileAt</span><span class="params">(path <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	file, err := os.Create(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	data := <span class="string">&quot;data \n for \t writing!&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 偏移量手动改变</span></span><br><span class="line">		file.WriteAt([]<span class="type">byte</span>(data), <span class="type">int64</span>(i*<span class="built_in">len</span>(data)))</span><br><span class="line">	&#125;</span><br><span class="line">	file.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-2-4-文件删除"><a href="#11-2-4-文件删除" class="headerlink" title="11.2.4 文件删除"></a>11.2.4 文件删除</h3><p>和目录一样调用<code>Remove</code>和<code>RemoveAll</code>即可，</p>
<h2 id="11-3-处理json文件"><a href="#11-3-处理json文件" class="headerlink" title="11.3 处理json文件"></a>11.3 处理json文件</h2><p>javaScript Object Notation，</p>
<blockquote>
<p>当我们需要对大量的JSON进行快速解析处理时，标准库提供的JSON处理库“encoding&#x2F;json” 可能就不能满足我们的需求，GitHub开源了一个比标准库解析速度快10倍的[fastjson库](https:&#x2F;&#x2F; github.com&#x2F;valyala&#x2F;fastjson)</p>
</blockquote>
<h3 id="11-3-1-编码JSON"><a href="#11-3-1-编码JSON" class="headerlink" title="11.3.1 编码JSON"></a>11.3.1 编码JSON</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Marshal</span> <span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>
<p><code>Marshal</code>返回interface的JSON编码，v通常会用map或结构体，返回的[]byte可以转成string查看，但此时并没有格式化，输出一行json字符串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MarshalIndent</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;, prefix, indent <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>
<p><code>MarshalIndent</code>返回的是JSON编码的格式化形式，prefix为每一行的开头，indent是缩进的格式，都是字符串</p>
<h5 id="map存json"><a href="#map存json" class="headerlink" title="map存json"></a>map存json</h5><ul>
<li>例程<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>] <span class="keyword">interface</span>&#123;&#125;, <span class="number">6</span>) <span class="comment">// string为键，interface&#123;&#125;为值的map，最大存6个</span></span><br><span class="line">m[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;walle&quot;</span></span><br><span class="line">m[<span class="string">&quot;age&quot;</span>] = <span class="number">1</span></span><br><span class="line">m[<span class="string">&quot;sex&quot;</span>] = <span class="literal">true</span></span><br><span class="line">m[<span class="string">&quot;language&quot;</span>] = []<span class="type">string</span>&#123;<span class="string">&quot;Go&quot;</span>, <span class="string">&quot;PHP&quot;</span>, <span class="string">&quot;PYTHON&quot;</span>&#125;</span><br><span class="line">result, _ := json.Marshal(m)</span><br><span class="line">resultFormat, _ := json.MarshalIndent(m, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;----&quot;</span>) <span class="comment">// 每一行以1开头，然后用----缩进</span></span><br><span class="line">fmt.Println(<span class="type">string</span>(result))</span><br><span class="line">fmt.Println(<span class="type">string</span>(resultFormat))</span><br></pre></td></tr></table></figure></li>
<li>输出结果<blockquote>
<p>{“age”:1,”language”:[“Go”,”PHP”,”PYTHON”],”name”:”walle”,”sex”:true}<br>{<br>1—-“age”: 1,<br>1—-“language”: [<br>1——–”Go”,<br>1——–”PHP”,<br>1——–”PYTHON”<br>1—-],<br>1—-“name”: “walle”,<br>1—-“sex”: true<br>1}</p>
</blockquote>
</li>
</ul>
<h5 id="struct存json"><a href="#struct存json" class="headerlink" title="struct存json"></a>struct存json</h5><p>大多数情况使用struct结构体会更方便，可以在定义struct的成员变量时添加<strong>标签</strong>控制编码和解码：</p>
<ul>
<li><code>&quot;-&quot;</code>：不要解析这个字段</li>
<li><code>&quot;omitempty&quot;</code>：字段为空时，不要解析</li>
<li><code>&quot;FieldName&quot;</code>：解析时用这个名字</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name     <span class="type">string</span>   <span class="string">`json:&quot;Name1&quot;`</span> <span class="comment">//以Name1编码</span></span><br><span class="line">	Age      <span class="type">int</span>      <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">	Sex      <span class="type">bool</span>     <span class="string">`json:&quot;-&quot;`</span> <span class="comment">// 不解析</span></span><br><span class="line">	Birthday <span class="type">string</span>   <span class="string">`json:&quot;birthday&quot;`</span></span><br><span class="line">	Company  <span class="type">string</span>   <span class="string">`json:&quot;company,omitempty&quot;`</span> <span class="comment">// 空时（默认值时）不解析</span></span><br><span class="line">	Language []<span class="type">string</span> <span class="string">`json:&quot;language&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line">person := Person&#123;<span class="string">&quot;walle&quot;</span>, <span class="number">10</span>, <span class="literal">true</span>, <span class="string">&quot;1900-1-1&quot;</span>, <span class="string">&quot;&quot;</span>,</span><br><span class="line">	[]<span class="type">string</span>&#123;</span><br><span class="line">		<span class="string">&quot;go&quot;</span>,</span><br><span class="line">		<span class="string">&quot;json&quot;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line">result, err := json.MarshalIndent(person, <span class="string">&quot;&quot;</span>, <span class="string">&quot;    &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="type">string</span>(result))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>{<br>“Name1”: “walle”,<br>“age”: 10,<br>“birthday”: “1900-1-1”,<br>“language”: [<br> “go”,<br> “json”<br>]<br>}</p>
</blockquote>
<h3 id="11-3-2-解码JSON"><a href="#11-3-2-解码JSON" class="headerlink" title="11.3.2 解码JSON"></a>11.3.2 解码JSON</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unmarshal</span><span class="params">(data []<span class="type">byte</span>, v <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">error</span></span><br></pre></td></tr></table></figure>
<p>将解析json编码的数据放到v中，</p>
<h4 id="使用map存放"><a href="#使用map存放" class="headerlink" title="使用map存放"></a>使用map存放</h4><p>map可以通过键获获取值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">map1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;, <span class="number">6</span>)</span><br><span class="line">err1 := json.Unmarshal([]<span class="type">byte</span>(jsonStr), &amp;map1)</span><br><span class="line"><span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println( map1)</span><br><span class="line"><span class="comment">// map[Name:walle Sex:true age:10 birthday:1900-1-1 language:[go json]]</span></span><br></pre></td></tr></table></figure>
<p>如果要知道类型，需要进行<strong>类型断言</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> map1 &#123;</span><br><span class="line">    <span class="keyword">switch</span> data := value.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;string&quot;</span>, key, data)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">bool</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;bool&quot;</span>, key, data)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;int&quot;</span>, key, data)</span><br><span class="line">    <span class="keyword">case</span> []<span class="type">string</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;[]string&quot;</span>, key, data)</span><br><span class="line">    <span class="keyword">case</span> []<span class="keyword">interface</span>&#123;&#125;:</span><br><span class="line">        fmt.Println(<span class="string">&quot;[]interface&quot;</span>, key, data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用struct存放（推荐）"><a href="#使用struct存放（推荐）" class="headerlink" title="使用struct存放（推荐）"></a>使用struct存放（推荐）</h4><p>其实就说struct内部已经定义好了类型，所以无需类型判断</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 Person <span class="comment">// 用到了11.3.1的Person结构体</span></span><br><span class="line">err2 := json.Unmarshal([]<span class="type">byte</span>(jsonStr), &amp;person1)</span><br><span class="line"><span class="keyword">if</span> err2 != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;person = %+v&quot;</span>, person1) </span><br><span class="line">   <span class="comment">//person = &#123;Name: Age:10 Sex:false Birthday:1900-1-1 Company: Language:[go json]&#125; </span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Wallnut</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"drinkwateronly/comments","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
